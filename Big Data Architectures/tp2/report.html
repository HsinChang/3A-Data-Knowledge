<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DK908b</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="big-data-architecture-lab-2">Big Data Architecture Lab 2</h1>
<h3 id="zhang-xin">ZHANG Xin</h3>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#task-0-setup">Task 0: setup</a>
<ul>
<li><a href="#1-create-a-directory-and-launch-the-server">1. Create a directory and launch the server</a></li>
<li><a href="#2-import-the-document-moviepeople-10jsonl-into-the-server">2. Import the document <code>moviepeople-10.jsonl</code> into the server.</a></li>
<li><a href="#3-launch-a-client-mongo-shell-retrieve-all-the-documents-by-asking-a-query-in-the-client">3. Launch a client (mongo shell), retrieve all the documents by asking a query in the client.</a></li>
</ul>
</li>
<li><a href="#task-1-import-and-querying">Task 1: import and querying</a>
<ul>
<li><a href="#1-import-the-documents-moviepeople-3000jsonl-and-citiesjsonl-into-the-server-the-one-set-up-in-task-0">1. Import the documents <code>moviepeople-3000.jsonl</code> and cities.jsonl into the server (the one set up in Task 0).</a></li>
<li><a href="#2-in-the-mongo-shell-client-write-queries-finding">2. In the mongo shell client, write queries finding:</a>
<ul>
<li><a href="#a-the-person-named-anabela-teixeira">a) the person named Anabela Teixeira</a></li>
<li><a href="#b-the-birthplace-of-steven-spielberg">b) the birthplace of Steven Spielberg</a></li>
<li><a href="#c-the-number-of-people-born-in-lisbon">c) the number of people born in Lisbon</a></li>
<li><a href="#d-the-people-taller-than-170-cm">d) the people taller than 170 cm</a></li>
<li><a href="#e-the-names-of-people-whose-information-contains-%22opera%22">e) the names of people whose information contains “Opera”</a></li>
<li><a href="#f-for-each-movie-person-whose-birth-place-is-known-the-latitude-longitude-and-population-of-that-city-if-that-information-exists-in-the-city-document">f) for each movie person whose birth place is known, the latitude, longitude and population of that city (if that information exists in the city document).</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#task-2-replication">Task 2: replication</a>
<ul>
<li><a href="#1-create-working-directories-for-3-mongodb-servers">1. Create working directories for 3 MongoDB servers.</a></li>
<li><a href="#2-create-a-replica-set-for-a-collection-called-small-movie">2. Create a replica set for a collection called small-movie.</a></li>
<li><a href="#3-launch-the-three-mongodb-servers-in-di-erent-shells-and-let-them-run">3. Launch the three MongoDB servers (in dierent shells) and let them run.</a>
<ul>
<li><a href="#server-1">Server 1</a></li>
<li><a href="#server-2">Server 2</a></li>
<li><a href="#server-3">Server 3</a></li>
</ul>
</li>
<li><a href="#4-connect-a-client-mongo-to-one-server-through-the-client-initialize-the-replication-add-one-other-server-as-secondary-and-add-the-third-one-as-arbiter">4. Connect a client (mongo) to one server. Through the client, initialize the replication: add one other server as secondary, and add the third one as arbiter.</a></li>
<li><a href="#5-identify-the-master-from-the-outputs-of-the-servers-and-by-requesting-replica-set-information-from-the-servers">5. Identify the master from the outputs of the servers’ and by requesting replica set information from the servers.</a>
<ul>
<li><a href="#output-of-server-3">Output of server 3:</a></li>
</ul>
</li>
<li><a href="#6-import-moviepeople-1000jsonl-through-the-master-observe-the-output-of-the-two-other-servers">6. Import <code>moviepeople-1000.jsonl</code> through the master. Observe the output of the two other servers.</a>
<ul>
<li><a href="#server-1-primary">Server 1 Primary</a></li>
<li><a href="#server-2-secondary">Server 2 SECONDARY</a></li>
<li><a href="#server-3-arbiter">Server 3 ARBITER</a></li>
</ul>
</li>
<li><a href="#7-once-the-synchronization-is-finished-stop-ctrl-c-the-master-observe-the-output-of-the-two-other-servers">7. Once the synchronization is finished, stop (ctrl-c) the master. Observe the output of the two other servers.</a>
<ul>
<li><a href="#from-server-1">from server 1</a></li>
<li><a href="#from-server-2">from server 2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#task-3-sharding">Task 3: sharding</a>
<ul>
<li><a href="#1-start-two-shard-servers">1. Start two shard servers.</a>
<ul>
<li><a href="#shard-server-1">shard server 1</a></li>
<li><a href="#shard-server-2">shard server 2</a></li>
<li><a href="#shard-config-server">shard config server</a></li>
<li><a href="#starting-mongos-connected-to-the-config">starting mongos connected to the config</a></li>
<li><a href="#configure-sharding">Configure sharding</a></li>
</ul>
</li>
<li><a href="#2-shard-the-cities-by-the-country">2. Shard the cities by the country.</a></li>
</ul>
</li>
</ul>
<h2 id="task-0-setup">Task 0: setup</h2>
<p>Task 0 and Task 1 outputs are from MongoDB v2.6.12 except <a href="#f-for-each-movie-person-whose-birth-place-is-known-the-latitude-longitude-and-population-of-that-city-if-that-information-exists-in-the-city-document">Task1.2.(f)</a></p>
<h3 id="create-a-directory-and-launch-the-server">1. Create a directory and launch the server</h3>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">mkdir</span> server_1
mongod --dbpath server_1
</code></pre>
<p>The port <em>27017</em> is used.</p>
<h3 id="import-the-document-moviepeople-10.jsonl-into-the-server.">2. Import the document <code>moviepeople-10.jsonl</code> into the server.</h3>
<pre class=" language-bash"><code class="prism  language-bash">mongoimport --db movies --file lab_2_datasets/moviepeople-10.jsonl --collection movies10
connected to: 127.0.0.1
2019-10-05T17:01:58.792+0200 imported 10 objects
</code></pre>
<h3 id="launch-a-client-mongo-shell-retrieve-all-the-documents-by-asking-a-query-in-the-client.">3. Launch a client (mongo shell), retrieve all the documents by asking a query in the client.</h3>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> use movies
switched to db movies
<span class="token operator">&gt;</span> db.movies10.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd286559094705"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Cáceres, Luciano"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Grew up in Buenos Aires's neighborhood Bajo Flores."</span>, <span class="token string">"Was classmates of 'Sergio Surraco' (qv), 'Claudio Tolcachir' (qv), 'Lautaro Delgado' (qv) and 'Melina Petriella' (qv) at the drama school."</span>, <span class="token string">"Stepfather of 'Ángela Torres (III)' (qv)."</span>, <span class="token string">"Became a father for the 1st time at age 32 when his wife 'Gloria Carrá' (qv) gave birth to their daughter Amelia Cáceres on October 7, 2009."</span>, <span class="token string">"Met wife 'Gloria Carrá' (qv) in 2001, but they didn't become a couple until 2007."</span>, <span class="token string">"Is an accomplished stage actor/director."</span>, <span class="token string">"Was in a relationship with actress 'Laura Lopez Moyano' (qv) (2005-2007)."</span>, <span class="token string">"His mother, political activist Haydeé Bello, died of cancer on June 15, 2002."</span>, <span class="token string">"Studied acting with 'Alejandra Boero' (qv)."</span>, <span class="token string">"He started taking acting classes at the age of 9."</span>, <span class="token string">"Son of 'Ernesto Cáceres' (qv) and Haydeé Bello."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Autonomous City of Buenos Aires, Argentina"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"24 January 1977"</span> <span class="token punctuation">]</span>, <span class="token string">"height"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"187 cm"</span> <span class="token punctuation">]</span>, <span class="token string">"spouse"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"'Gloria Carrá' (qv) (27 September 2008 - 2015) (separated); 1 child"</span> <span class="token punctuation">]</span>, <span class="token string">"nicknames"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Lu"</span> <span class="token punctuation">]</span>, <span class="token string">"trademark"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Curly hair"</span>, <span class="token string">"Bright blue eyes"</span> <span class="token punctuation">]</span>, <span class="token string">"interviews"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Clarín (Argentina), 9 January 2007, by: María Ana Rago, Luciano Cáceres: El teatro en la sangre"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd286559094706"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Hughart, Ron"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Los Angeles, California, USA"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"18 June 1961"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Hughart, Ronald P"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd286559094708"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Stokely, Charlotte"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Is represented by John Baumgartner and Sandra McCarthy's Nevada-organized talent agency OC Modeling LLC."</span> <span class="token punctuation">]</span>, <span class="token string">"minibiography"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Very cute and slim 5'3 blonde Charlotte Stokely was born on August 8, 1986 in Salt Lake City, Utah. Stokely decided to pursue a career in the adult entertainment industry after her stripper roommate was asked to participate in a hardcore shoot and Stokely herself was approached to appear on camera as well. After initially establishing herself in hardcore shoots for primarily Florida-based adult websites, Charlotte subsequently got herself an agent and moved to Los Angeles, California to advance her career by doing features for such top companies as FM Concepts, Sin City, Evil Angel, Wicked Pictures, Zero Tolerance, Evasive Angles, Digital Playground, Pulse Distribution, and Pure Play Media. Stokely was nominated for an AVN Award for Best New Starlet in 2007. Moreover, Charlotte has also modeled for several American Apparel ads. She enjoys playing Dungeons &amp; Dragons in her spare time."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Utah, USA"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"8 August 1986"</span> <span class="token punctuation">]</span>, <span class="token string">"height"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"160 cm"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Vitale, Brittney"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd286559094709"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"O'Brien, Robert"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"New York City, New York, USA"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"8 May 1918"</span> <span class="token punctuation">]</span>, <span class="token string">"deathdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"7 November 2005"</span> <span class="token punctuation">]</span>, <span class="token string">"spouse"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"'Lina Romay (I)' (qv) (1992 - 7 November 2005) (his death)"</span> <span class="token punctuation">]</span>, <span class="token string">"deathnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Los Angeles, California, USA"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd28655909470a"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Wedemeyer, Herman"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Inducted into the Polynesian Football Hall of Fame in 2014 (inaugural class)."</span>, <span class="token string">"(1950) Played minor league baseball with the Salt Lake City Bees in the Pioneer League (C level)."</span>, <span class="token string">"Inducted into the Saint Mary's College Athletic Hall of Fame in 1973."</span>, <span class="token string">"Inducted into the Hawaii Sports Hall of Fame in 1998."</span>, <span class="token string">"Herman is the older brother of Charlie Wedemeyer. Charlie, a former Michigan State football player, eventually (as head football coach at Los Gatos High School in California) gained fame when he continued to coach for many years, after being confined to a wheelchair from contracting 'Lou Gehrig' (qv)'s Disease. He is the subject of _Quiet Victory: The Charlie Wedemeyer Story (1988) (TV)_ (qv)."</span>, <span class="token string">"Halfback on the football team of St. Mary's College (Moraga, CA), 1943, 1945-1947."</span>, <span class="token string">"Inducted into the College Football Hall of Fame in 1979."</span>, <span class="token string">"Wedemeyer was elected to the Honolulu City Council as a Republican in 1968, and then elected to the state House of Representatives as a Democrat in 1970. He won re-election in 1972."</span>, <span class="token string">"Played halfback/tailback for the Los Angeles Dons (1948) and Baltimore Colts (1949) of the All-America Football Conference (a rival of the National Football League, 1946-1949)."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Hilo, Hawaii, USA"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"20 May 1924"</span> <span class="token punctuation">]</span>, <span class="token string">"height"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"5' 10"</span> <span class="token punctuation">]</span>, <span class="token string">"deathdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"25 January 1999"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Wedemeyer, Herman John"</span> <span class="token punctuation">]</span>, <span class="token string">"nicknames"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"The Waikiki Wonder"</span>, <span class="token string">"The Flyin' Hawaiian"</span>, <span class="token string">"The Hula-hipped Hawaiian"</span>, <span class="token string">"The Hawaiian Centipede"</span>, <span class="token string">"Squirmin' Herman"</span> <span class="token punctuation">]</span>, <span class="token string">"deathnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Honolulu, Hawaii, USA (heart attack)"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd28655909470b"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Goyanes, María José"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Mother of actor 'Javier Collado (I)' (qv)."</span>, <span class="token string">"Sister of actress 'Mara Goyanes' (qv)"</span>, <span class="token string">"Daughter of actress 'Mimí Muñoz' (qv)"</span>, <span class="token string">"Sister of actress 'Vicky Lagos (I)' (qv)"</span>, <span class="token string">"Sister of actress 'Concha Goyanes' (qv)"</span>, <span class="token string">"Sister-in-law of actor 'Ismael Merlo' (qv)"</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Spain"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"8 December 1948"</span> <span class="token punctuation">]</span>, <span class="token string">"spouse"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"'Manuel Collado' (qv) (? - ?)"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Muñoz, María José Goyanes"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd286559094707"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Hemsworth, Liam"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"quotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"_The Hunger Games (2012)_ (qv) absolutely changed my life. It's brought up so many different questions about my own personal growth and where I was heading. I think, before all of it, I really felt like I had it figured out. Like, you know, it's going to be fine, I'm this person and I know what I want to be and I know where I want to go. But then it got to the point where I think I started double-questioning everything. It was like, why am I doing this? where is it getting me? what if I do this and then I can do this? I wasn't living in the moment."</span>, <span class="token string">"One of the biggest inspirations before I started shooting came from my brother, when he texted me and said, Hey, fatty, it's called 'The Hunger Games', not 'The Eating Games'.. So I started working out a lot more and eating a lot less."</span> <span class="token punctuation">]</span>, <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"(2016) Became the first celebrity face of Diesel Only The Brave fragrance."</span>, <span class="token string">"Liam's childhood crush was 'Alyssa Milano' (qv) from his favorite weekly show _Charmed (1998)_ (qv)."</span>, <span class="token string">"His uncle was bushman Rod Ansell, who inspired the film _Crocodile Dundee (1986)_ (qv). Rod was married to Liam's aunt (Liam's mother's sister), Joanne van Os, who is an author."</span>, <span class="token string">"Cousin Rob Hemsworth, an oyster farmer, competed on Season 6 of _My Kitchen Rules (2010)_ (qv), representing Victoria."</span>, <span class="token string">"Was originally going to appear in _The Expendables (2010)_ (qv), but was written out due of doing the screen test for _Thor (2011)_ (qv). He would later appear in _The Expendables 2 (2012)_ (qv)."</span>, <span class="token string">"Favorite actors include 'Leonardo DiCaprio' (qv), 'Heath Ledger' (qv), and 'Paul Newman (I)' (qv) among others."</span>, <span class="token string">"Before his career in acting took off, Liam worked some odd jobs that included nature park ranger, bakery assistant and bowling alley employee."</span>, <span class="token string">"Was considered for the title role in _Thor (2011)_ (qv), which ultimately went to his brother, 'Chris Hemsworth' (qv)."</span>, <span class="token string">"Favorite films include _The Goonies (1985)_ (qv), _James Dean (2001) (TV)_ (qv), _A Guide to Recognizing Your Saints (2006)_ (qv), _The Departed (2006)_ (qv) and _Step Brothers (2008)_ (qv)."</span>, <span class="token string">"Ranked the #3 Sexiest Man in 2013 by Glamour, several places ahead of his older brother 'Chris Hemsworth' (qv) who ranked in at number 7."</span>, <span class="token string">"(September 16, 2013) Ended engagement to 'Miley Cyrus' (qv)."</span>, <span class="token string">"His maternal grandfather, Martin van Os, is a Dutch immigrant. The rest of Liam's ancestry is Irish, English, and smaller amounts of German and Scottish."</span>, <span class="token string">"Between auditions, he used to lay floors."</span>, <span class="token string">"Younger brother of actor 'Chris Hemsworth' (qv) and 'Luke Hemsworth' (qv)."</span>, <span class="token string">"Was considered one of the 55 faces of the future by Nylon Magazine's Young Hollywood Issue."</span>, <span class="token string">"Brother-in-law of 'Elsa Pataky' (qv)."</span> <span class="token punctuation">]</span>, <span class="token string">"minibiography"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Liam Hemsworth was born on January 13, 1990, in Melbourne, Australia, and is the younger brother of actors 'Chris Hemsworth' (qv) and 'Luke Hemsworth' (qv). He is the son of Leonie (van Os), a teacher of English, and Craig Hemsworth, a social-services counselor. He is of Dutch (from his immigrant maternal grandfather), Irish, English, Scottish, and German ancestry. His uncle, by marriage, was Rod Ansell, the bushman who inspired the film _Crocodile Dundee (1986)_ (qv).  The Hemsworth family lived primarily on Phillip Island, a small island located south of Melbourne. Following in the footsteps of his older brothers, who went into acting in their teens, Liam scored his first audition at age 16 and appeared on the Australian TV series _Home and Away (1988)_ (qv) and _McLeod's Daughters (2001)_ (qv) before taking on a recurring character role on the soap opera _Neighbours (1985)_ (qv), in which his brother Luke had also appeared. Roles on TV shows _The Elephant Princess (2008)_ (qv) and _Satisfaction (2007)_ (qv) followed before Liam moved to the United States to pursue a big-screen career.  After suffering two setbacks - his character was written out of the script for _The Expendables (2010)_ (qv) days before filming and he lost the title role of _Thor (2011)_ (qv) to his brother Chris - Liam was cast opposite 'Miley Cyrus' (qv) in the 'Nicholas Sparks (I)' (qv) drama _The Last Song (2010)_ (qv). The two, who played love interests in the film, soon started dating, and Liam appeared in Cyrus' music video When I Look at You. Following that film's modest commercial success, and the attendant press coverage of his rising career and high-profile romance, he was almost immediately thrust into leading man status, and was cast as Gale Hawthorne in the big-screen adaptation of the best-selling novel _The Hunger Games (2012)_ (qv). Following the blockbuster success of that film, Liam nabbed a number of roles, including a supporting part in _The Expendables 2 (2012)_ (qv) and leading roles in the war drama _Love and Honor (2013)_ (qv), the crime drama _Empire State (2013)_ (qv), and the thriller _Paranoia (2013/I)_ (qv). He will also star as Ali Baba in a 3D production of _Arabian Nights (????)_ (qv) and will reprise the role of Gale Hawthorne in _The Hunger Games: Catching Fire (2013)_ (qv).  Hemsworth was engaged to 'Miley Cyrus' (qv) from June 2012 to September 2013."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Melbourne, Victoria, Australia"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"13 January 1990"</span> <span class="token punctuation">]</span>, <span class="token string">"height"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"6' 3"</span> <span class="token punctuation">]</span>, <span class="token string">"otherworks"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"(2011) Music video for Zac Brown Band - Colder Weather"</span>, <span class="token string">"Music video for 'Miley Cyrus' (qv): When I Look At You."</span>, <span class="token string">"(2016) TV commercial for Diesel Only the Brave - The Fragrance - Actor with 'Valerie Martinez (II)' (qv). Director: 'Anthony Atanasio' (qv)"</span> <span class="token punctuation">]</span>, <span class="token string">"books"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Posy Edwards. _Liam Hemsworth: Against All Odds._ London, England: Orion Publishing, 2012. ISBN 9781409143772"</span> <span class="token punctuation">]</span>, <span class="token string">"trademark"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Towering height"</span>, <span class="token string">"Blue eyes"</span> <span class="token punctuation">]</span>, <span class="token string">"article"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"USA Today (USA), 20 November 2015, Vol. 34, Iss. 49, pg. 1B-2B, by: Bryan Alexander, 'HUNGER GAMES' TRIO TAKE THEIR FINAL BOW - For these three fast friends, 'Mockingjay - Part 2' marks the end of their adventure"</span>, <span class="token string">"USA Today (USA), 27 June 2016, Vol. 34, Iss. 202, pg. 2D, by: Brian Truitt, 'Independence Day' sequel isn't worth a worldwide celebration"</span> <span class="token punctuation">]</span>, <span class="token string">"magazinecoverphoto"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Entertainment Weekly (USA), 11 October 2013, Iss. 1280"</span> <span class="token punctuation">]</span>, <span class="token string">"pictorial"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Vanity Fair (USA), March 2013, Iss. 631, pg. 346, by: Bruce Weber, Bruce Weber's Adventures in Hollywood"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd28655909470c"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Rath, Franz"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"22 June 1932"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd28655909470d"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"van Mello, Luk"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"He studied drama at the Koninlijk Conservatorium in Brussels, Belgium. He had some famous teachers, such as 'Nand Buyl' (qv) and 'Leo Dewals' (qv). People like 'Luk De Konink' (qv), 'Jaak Van Assche' (qv), 'Tessy Moerenhout' (qv), 'Luc Springuel' (qv), 'Gilda De Bal' (qv), 'Josse De Pauw' (qv), 'Magda De Winter' (qv), 'Chris Cauwenbergs' (qv), 'Tuur De Weert' (qv) and 'René Verreth' (qv) were his co-students."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Opbrakel, Flanders, Belgium"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"1 September 1950"</span> <span class="token punctuation">]</span>, <span class="token string">"otherworks"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Provided a voice in the Dutch version of _Simsala Grimm - Die Märchen der Brüder Grimm (1999)_ (qv)."</span>, <span class="token string">"Provided the voice of Luke in the Dutch version of _Jim Knopf (2000)_ (qv) (Jim Button)."</span>, <span class="token string">"Provided the voice of Uncle Max in the Dutch version of _The Lion King 1½ (2004) (V)_ (qv)."</span>, <span class="token string">"Provided the voice of Murphy in the Dutch version of _Spirit: Stallion of the Cimarron (2002)_ (qv)."</span>, <span class="token string">"Provided the voice of Hamm in the Dutch version of _Toy Story 2 (1999)_ (qv)."</span>, <span class="token string">"Provided the voice of Acoliet in the Dutch version of _The Road to El Dorado (2000)_ (qv)."</span>, <span class="token string">"Provided a voice in the Dutch version of _Stuart Little (1999)_ (qv)."</span>, <span class="token string">"Provided the voice of Kolonel in the Dutch version of _La gabbianella e il gatto (1998)_ (qv)."</span>, <span class="token string">"Provided the voice of Coach Fanelli in the Dutch version of _Air Bud: Golden Receiver (1998)_ (qv)."</span>, <span class="token string">"Provided the voice of Stekel in the Dutch version of _A Bug's Life (1998)_ (qv)."</span>, <span class="token string">"Provided the voice of Hamm in the Dutch version of _Toy Story (1995)_ (qv)."</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"van Mello, Luc Jean-Marie Joseph"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d920f2f1cfd28655909470e"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Okamoto, Fujita"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Yokohama, Japan"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"21 November 1946"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<p><a></a></p>
<h2 id="task-1-import-and-querying">Task 1: import and querying</h2>
<h3 id="import-the-documents-moviepeople-3000.jsonl-and-cities.jsonl-into-the-server-the-one-set-up-in-task-0.">1. Import the documents <code>moviepeople-3000.jsonl</code> and cities.jsonl into the server (the one set up in Task 0).</h3>
<pre class=" language-bash"><code class="prism  language-bash">
$ mongoimport --db movies --file lab_2_datasets/moviepeople-3000.jsonl --collection movies3000
connected to: 127.0.0.1
2019-10-05T18:17:24.666+0200 check 9 3000
2019-10-05T18:17:24.740+0200 imported 3000 objects
$ mongoimport --db movies --file lab_2_datasets/cities.jsonl --collection cities
connected to: 127.0.0.1
2019-10-05T18:17:53.733+0200 check 9 99838
2019-10-05T18:17:54.230+0200 imported 99838 objects
</code></pre>
<h3 id="in-the-mongo-shell-client-write-queries-finding">2. In the mongo shell client, write queries finding:</h3>
<h4 id="a-the-person-named-anabela-teixeira">a) the person named Anabela Teixeira</h4>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"person-name"</span><span class="token keyword">:</span><span class="token string">"Teixeira, Anabela"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d9213ed1cfd2865590948c6"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Teixeira, Anabela"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Her favorite actor is 'Marcello Mastroianni' (qv) and her favorite actress is 'Juliette Binoche' (qv)."</span>, <span class="token string">"Partner of musician Frederico Pereira."</span>, <span class="token string">"Has two brothers, one biological and one adopted."</span>, <span class="token string">"Vice-President of the Portuguese Cinema Academy."</span>, <span class="token string">"She was first noticed by the public with the Tv series A Viúva do Enforcado (1992)."</span>, <span class="token string">"Made her theater debut in 1992 in the play Os Processos of Dostolevsky."</span>, <span class="token string">"Did some workshops of dance: dance in movement with Peter Diez and dance classes with Madalena Vitorino."</span>, <span class="token string">"Besides Portuguese, she speaks English and French."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Lisbon, Portugal"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"18 May 1973"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Teixeira, Anabela Cristina Alves"</span> <span class="token punctuation">]</span>, <span class="token string">"interviews"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"TV Guia (Portugal), 1997, Iss. 960, pg. 24-25, by: Pedro Teixeira"</span>, <span class="token string">"A Capital (Portugal), 30 April 1998, pg. 55, by: Helena Mata"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<h4 id="b-the-birthplace-of-steven-spielberg">b) the birthplace of Steven Spielberg</h4>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.find<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">"person-name"</span><span class="token keyword">:</span><span class="token string">"Spielberg, Steven"</span> <span class="token punctuation">}</span>,<span class="token punctuation">{</span> <span class="token string">"info.birthnotes"</span><span class="token keyword">:</span> 1, _id:0<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Cincinnati, Ohio, USA"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<h4 id="c-the-number-of-people-born-in-lisbon">c) the number of people born in Lisbon</h4>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"info.birthnotes"</span><span class="token keyword">:</span><span class="token string">"Lisbon, Portugal"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
171
</code></pre>
<h4 id="d-the-people-taller-than-170-cm">d) the people taller than 170 cm</h4>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.find<span class="token punctuation">(</span><span class="token string">"this.info.height &gt; 170"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"_id"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d9213ee1cfd286559095111"</span><span class="token punctuation">)</span>, <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Filho, Tarcísio"</span>, <span class="token string">"info"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"trivia"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"Son of 'Tarcísio Meira' (qv) and 'Glória Menezes' (qv)"</span>, <span class="token string">"Has two half-siblings named Maria Amélia (born in 1957) and João Paulo (born in 1959)."</span> <span class="token punctuation">]</span>, <span class="token string">"birthnotes"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"São Paulo, São Paulo, Brazil"</span> <span class="token punctuation">]</span>, <span class="token string">"birthdate"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"22 August 1964"</span> <span class="token punctuation">]</span>, <span class="token string">"height"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"181"</span> <span class="token punctuation">]</span>, <span class="token string">"spouse"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"'Luzia Dvorek' (? - ?) (divorced)"</span> <span class="token punctuation">]</span>, <span class="token string">"birthname"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span> <span class="token string">"de Magalhães, Tarcísio Pereira Filho"</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<h4 id="e-the-names-of-people-whose-information-contains-opera">e) the names of people whose information contains “Opera”</h4>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"info.trivia"</span>:/ Opera /<span class="token punctuation">}</span>,<span class="token punctuation">{</span>_id:0, <span class="token string">"person-name"</span>:1 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Rolfe, James"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Mascolo, Joseph"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Bailey, Laura"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Christian, Shawn"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Fulton, Eileen"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Springer, Jerry"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Heinle, Amelia"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Mattson, Robin"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Egan, Melissa Claire"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"de la Fuente, Cristián"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"O'Shaughnessey, Colleen"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Bjorlin, Nadia"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"person-name"</span> <span class="token keyword">:</span> <span class="token string">"Randall, Tony"</span> <span class="token punctuation">}</span>
</code></pre>
<h4 id="f-for-each-movie-person-whose-birth-place-is-known-the-latitude-longitude-and-population-of-that-city-if-that-information-exists-in-the-city-document.">f) for each movie person whose birth place is known, the latitude, longitude and population of that city (if that information exists in the city document).</h4>
<p>This command is run under MongoDB version v4.0.12 instead of v2.6.12 in order to use <code>$lookup</code> for aggregation.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> db.movies3000.aggregate<span class="token punctuation">(</span><span class="token punctuation">[</span>
	<span class="token punctuation">{</span><span class="token variable">$project</span><span class="token keyword">:</span> <span class="token punctuation">{</span>city <span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token variable">$split</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token variable">$arrayElemAt</span><span class="token punctuation">[</span><span class="token string">"<span class="token variable">$info</span>.birthnotes"</span>,0<span class="token punctuation">]</span><span class="token punctuation">}</span>, <span class="token string">", "</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
	<span class="token punctuation">{</span><span class="token variable">$lookup</span><span class="token keyword">:</span> <span class="token punctuation">{</span>from: <span class="token string">"cities"</span>,localField: <span class="token string">"city"</span>,foreignField:<span class="token string">"name"</span>,as:<span class="token string">"cit"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,
	<span class="token punctuation">{</span><span class="token variable">$unwind</span><span class="token keyword">:</span> <span class="token string">"<span class="token variable">$cit</span>"</span><span class="token punctuation">}</span>,
	<span class="token punctuation">{</span><span class="token variable">$project</span>:<span class="token punctuation">{</span>_id <span class="token keyword">:</span> 0, <span class="token string">"cit.name"</span>:1, <span class="token string">"cit.population"</span> <span class="token keyword">:</span> 1, <span class="token string">"cit.location"</span> <span class="token keyword">:</span> 1<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Chicago"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 2841952, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.85003, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -87.65005 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Chicago"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 2841952, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.85003, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -87.65005 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Salford"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 72750, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 53.48771, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -2.29042 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Eccles"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 37275, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 53.48333, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -2.33333 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"England"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 2950, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 34.54426, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -91.96903 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Omaha"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 390007, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.25861, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -95.93779 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 3855, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> -41.31667, <span class="token string">"longitude"</span> <span class="token keyword">:</span> 174.75 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1511, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 39.53921, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -86.36916 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1387, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.73361, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -92.44546 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1247, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 42.10587, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -84.24828 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 2300664, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 40.6501, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -73.94958 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"New York City"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 8008278, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 40.71427, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -74.00597 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 11037, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.43977, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -81.73541 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Brooklyn"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1120, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 42.85361, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -89.3704 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Philadelphia"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 7266, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 32.77152, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -89.11673 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Philadelphia"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1517550, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 39.95234, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -75.16379 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Philadelphia"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 1537, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 44.1545, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -75.70882 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Chicago"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 2841952, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 41.85003, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -87.65005 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Indianapolis"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 773283, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 39.76838, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -86.15804 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"cit"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"Indiana"</span>, <span class="token string">"population"</span> <span class="token keyword">:</span> 14357, <span class="token string">"location"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span> <span class="token string">"latitude"</span> <span class="token keyword">:</span> 40.62146, <span class="token string">"longitude"</span> <span class="token keyword">:</span> -79.15253 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
Type <span class="token string">"it"</span> <span class="token keyword">for</span> <span class="token function">more</span>
<span class="token operator">&gt;</span>
</code></pre>
<p>And I’ve checked, there are really multiple cities named “Brooklyn”, “Philadelphia”, “Washington”… in the file <code>cities.jsonl</code> and the real-life United States, Americans really don’t have too much creativity to name the cities they live in…</p>
<h2 id="task-2-replication">Task 2: replication</h2>
<p>Task 2 is run under MongoDB version v4.0.12</p>
<h3 id="create-working-directories-for-3-mongodb-servers.">1. Create working directories for 3 MongoDB servers.</h3>
<pre class=" language-bash"><code class="prism  language-bash">$ <span class="token function">mkdir</span> ./mongo1 ./mongo2 ./mongo3
</code></pre>
<h3 id="create-a-replica-set-for-a-collection-called-small-movie.">2. Create a replica set for a collection called small-movie.</h3>
<p>Because the <code>--rest</code> parameter was removed in MongoDB 3.6 as described in this page: <a href="https://docs.mongodb.com/manual/core/security-mongodb-configuration/">MongoDB Configuration Hardening</a> and this ticket: <a href="https://jira.mongodb.org/browse/SERVER-29000">SERVER-29000</a>, this step is done with the next one.</p>
<h3 id="launch-the-three-mongodb-servers-in-di-erent-shells-and-let-them-run.">3. Launch the three MongoDB servers (in dierent shells) and let them run.</h3>
<h4 id="server-1">Server 1</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ mongod --replSet small-movie --dbpath ./mongo1 --port 27011
2019-10-05T23:18:31.397+0200 I STORAGE  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Max cache overflow <span class="token function">file</span> size custom option: 0
2019-10-05T23:18:31.400+0200 I CONTROL  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols <span class="token string">'none'</span>
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>77052 port<span class="token operator">=</span>27011 dbpath<span class="token operator">=</span>./mongo1 64-bit host<span class="token operator">=</span>lame10.enst.fr
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v4.0.12
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: 5776e3cbf9e7afe86e6b29e22520ffb6766e95d4
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> OpenSSL version: OpenSSL 1.0.0-fips 29 Mar 2010
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> modules: none
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build environment:
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distmod: amazon
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distarch: x86_64
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     target_arch: x86_64
2019-10-05T23:18:31.404+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27011 <span class="token punctuation">}</span>, replication: <span class="token punctuation">{</span> replSet: <span class="token string">"small-movie"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo1"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-05T23:18:31.420+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> wiredtiger_open config: create,cache_size<span class="token operator">=</span>257478M,cache_overflow<span class="token operator">=</span><span class="token punctuation">(</span>file_max<span class="token operator">=</span>0M<span class="token punctuation">)</span>,session_max<span class="token operator">=</span>20000,eviction<span class="token operator">=</span><span class="token punctuation">(</span>threads_min<span class="token operator">=</span>4,threads_max<span class="token operator">=</span>4<span class="token punctuation">)</span>,config_base<span class="token operator">=</span>false,statistics<span class="token operator">=</span><span class="token punctuation">(</span>fast<span class="token punctuation">)</span>,log<span class="token operator">=</span><span class="token punctuation">(</span>enabled<span class="token operator">=</span>true,archive<span class="token operator">=</span>true,path<span class="token operator">=</span>journal,compressor<span class="token operator">=</span>snappy<span class="token punctuation">)</span>,file_manager<span class="token operator">=</span><span class="token punctuation">(</span>close_idle_time<span class="token operator">=</span>100000<span class="token punctuation">)</span>,statistics_log<span class="token operator">=</span><span class="token punctuation">(</span>wait<span class="token operator">=</span>0<span class="token punctuation">)</span>,verbose<span class="token operator">=</span><span class="token punctuation">(</span>recovery_progress<span class="token punctuation">)</span>,
2019-10-05T23:18:34.157+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310314:157591<span class="token punctuation">]</span><span class="token punctuation">[</span>77052:0x7f4b0f32a000<span class="token punctuation">]</span>, txn-recover: Set global recovery timestamp: 0
2019-10-05T23:18:34.261+0200 I RECOVERY <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger recoveryTimestamp. Ts: Timestamp<span class="token punctuation">(</span>0, 0<span class="token punctuation">)</span>
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.067+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.startup_log with generated UUID: 221448d6-1702-45aa-b775-fe22fb448951
2019-10-05T23:18:37.281+0200 I FTDC     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initializing full-time diagnostic data capture with directory <span class="token string">'./mongo1/diagnostic.data'</span>
2019-10-05T23:18:37.283+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.oplogTruncateAfterPoint with generated UUID: 5c5cdca6-b1e3-4c08-b4b8-65e8dccf4d08
2019-10-05T23:18:37.501+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.minvalid with generated UUID: 315be355-2a14-4a0f-9ebd-451fbe7a42fa
2019-10-05T23:18:37.710+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.election with generated UUID: f5cec572-4984-4e82-bcda-629f7d764493
2019-10-05T23:18:37.910+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local initialized voted <span class="token keyword">for</span> document at startup.
2019-10-05T23:18:37.910+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local Rollback ID document at startup. Creating one.
2019-10-05T23:18:37.910+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.system.rollback.id with generated UUID: 1bd96e2e-cf6a-4cdb-9244-aeb9ab9c68b8
2019-10-05T23:18:38.130+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initialized the rollback ID to 1
2019-10-05T23:18:38.130+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local replica <span class="token keyword">set</span> configuration document at startup<span class="token punctuation">;</span>  NoMatchingDocument: Did not <span class="token function">find</span> replica <span class="token keyword">set</span> configuration document <span class="token keyword">in</span> local.system.replset
2019-10-05T23:18:38.131+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions refresh interval: Replication has not yet been configured
2019-10-05T23:18:38.131+0200 I NETWORK  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27011
2019-10-05T23:18:38.132+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheReap<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions reap interval: config.system.sessions does not exist
</code></pre>
<h4 id="server-2">Server 2</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ mongod --replSet small-movie --dbpath ./mongo2 --port 27012
2019-10-05T23:23:53.378+0200 I STORAGE  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Max cache overflow <span class="token function">file</span> size custom option: 0
2019-10-05T23:23:53.381+0200 I CONTROL  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols <span class="token string">'none'</span>
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>78567 port<span class="token operator">=</span>27012 dbpath<span class="token operator">=</span>./mongo2 64-bit host<span class="token operator">=</span>lame10.enst.fr
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v4.0.12
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: 5776e3cbf9e7afe86e6b29e22520ffb6766e95d4
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> OpenSSL version: OpenSSL 1.0.0-fips 29 Mar 2010
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> modules: none
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build environment:
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distmod: amazon
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distarch: x86_64
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     target_arch: x86_64
2019-10-05T23:23:53.385+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27012 <span class="token punctuation">}</span>, replication: <span class="token punctuation">{</span> replSet: <span class="token string">"movie-small"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo2"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-05T23:23:53.392+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> wiredtiger_open config: create,cache_size<span class="token operator">=</span>257478M,cache_overflow<span class="token operator">=</span><span class="token punctuation">(</span>file_max<span class="token operator">=</span>0M<span class="token punctuation">)</span>,session_max<span class="token operator">=</span>20000,eviction<span class="token operator">=</span><span class="token punctuation">(</span>threads_min<span class="token operator">=</span>4,threads_max<span class="token operator">=</span>4<span class="token punctuation">)</span>,config_base<span class="token operator">=</span>false,statistics<span class="token operator">=</span><span class="token punctuation">(</span>fast<span class="token punctuation">)</span>,log<span class="token operator">=</span><span class="token punctuation">(</span>enabled<span class="token operator">=</span>true,archive<span class="token operator">=</span>true,path<span class="token operator">=</span>journal,compressor<span class="token operator">=</span>snappy<span class="token punctuation">)</span>,file_manager<span class="token operator">=</span><span class="token punctuation">(</span>close_idle_time<span class="token operator">=</span>100000<span class="token punctuation">)</span>,statistics_log<span class="token operator">=</span><span class="token punctuation">(</span>wait<span class="token operator">=</span>0<span class="token punctuation">)</span>,verbose<span class="token operator">=</span><span class="token punctuation">(</span>recovery_progress<span class="token punctuation">)</span>,
2019-10-05T23:23:55.868+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310635:868458<span class="token punctuation">]</span><span class="token punctuation">[</span>78567:0x7f0c9f8e0000<span class="token punctuation">]</span>, txn-recover: Set global recovery timestamp: 0
2019-10-05T23:23:55.980+0200 I RECOVERY <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger recoveryTimestamp. Ts: Timestamp<span class="token punctuation">(</span>0, 0<span class="token punctuation">)</span>
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-05T23:23:58.704+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-05T23:23:58.705+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:23:58.707+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:23:58.708+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-05T23:23:58.708+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-05T23:23:58.708+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-05T23:23:58.708+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:23:58.713+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.startup_log with generated UUID: 94307054-2b6e-4759-8a84-6a83eb6fe230
2019-10-05T23:23:59.079+0200 I FTDC     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initializing full-time diagnostic data capture with directory <span class="token string">'./mongo2/diagnostic.data'</span>
2019-10-05T23:23:59.080+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.oplogTruncateAfterPoint with generated UUID: b3e018a8-59a8-481b-801c-1322b33f50bc
2019-10-05T23:23:59.439+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.minvalid with generated UUID: 33324978-ae5a-4fec-b0d1-6da90927056a
2019-10-05T23:23:59.700+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.election with generated UUID: d1c191ea-8c16-40a6-becf-ec112d7d073d
2019-10-05T23:23:59.900+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local initialized voted <span class="token keyword">for</span> document at startup.
2019-10-05T23:23:59.900+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local Rollback ID document at startup. Creating one.
2019-10-05T23:23:59.900+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.system.rollback.id with generated UUID: 39c8beb4-89ff-4731-a23e-0830ebf69c73
2019-10-05T23:24:00.110+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initialized the rollback ID to 1
2019-10-05T23:24:00.110+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local replica <span class="token keyword">set</span> configuration document at startup<span class="token punctuation">;</span>  NoMatchingDocument: Did not <span class="token function">find</span> replica <span class="token keyword">set</span> configuration document <span class="token keyword">in</span> local.system.replset
2019-10-05T23:24:00.111+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions refresh interval: Replication has not yet been configured
2019-10-05T23:24:00.111+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheReap<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions reap interval: config.system.sessions does not exist
2019-10-05T23:24:00.111+0200 I NETWORK  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27012
^C2019-10-05T23:27:26.185+0200 I CONTROL  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> got signal 2 <span class="token punctuation">(</span>Interrupt<span class="token punctuation">)</span>, will terminate after current cmd ends
2019-10-05T23:27:26.185+0200 I NETWORK  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> shutdown: going to close listening sockets<span class="token punctuation">..</span>.
2019-10-05T23:27:26.185+0200 I NETWORK  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> removing socket file: /tmp/mongodb-27012.sock
2019-10-05T23:27:26.186+0200 I REPL     <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> shutting down replication subsystems
2019-10-05T23:27:26.187+0200 I ASIO     <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Killing all outstanding egress activity.
2019-10-05T23:27:26.187+0200 I CONTROL  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> Shutting down <span class="token function">free</span> monitoring
2019-10-05T23:27:26.188+0200 I FTDC     <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> Shutting down full-time diagnostic data capture
2019-10-05T23:27:26.208+0200 I STORAGE  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> WiredTigerKVEngine shutting down
2019-10-05T23:27:26.208+0200 I STORAGE  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> Shutting down session sweeper thread
2019-10-05T23:27:26.208+0200 I STORAGE  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> Finished shutting down session sweeper thread
2019-10-05T23:27:26.370+0200 I STORAGE  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> shutdown: removing fs lock<span class="token punctuation">..</span>.
2019-10-05T23:27:26.372+0200 I CONTROL  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> now exiting
2019-10-05T23:27:26.372+0200 I CONTROL  <span class="token punctuation">[</span>signalProcessingThread<span class="token punctuation">]</span> shutting down with code:0
<span class="token punctuation">[</span>xizhang@lame10<span class="token punctuation">]</span>~/tmp/bda2% mongod --replSet small-movie --dbpath ./mongo2 --port 27012
2019-10-05T23:28:15.253+0200 I STORAGE  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Max cache overflow <span class="token function">file</span> size custom option: 0
2019-10-05T23:28:15.256+0200 I CONTROL  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols <span class="token string">'none'</span>
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>80429 port<span class="token operator">=</span>27012 dbpath<span class="token operator">=</span>./mongo2 64-bit host<span class="token operator">=</span>lame10.enst.fr
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v4.0.12
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: 5776e3cbf9e7afe86e6b29e22520ffb6766e95d4
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> OpenSSL version: OpenSSL 1.0.0-fips 29 Mar 2010
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> modules: none
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build environment:
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distmod: amazon
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distarch: x86_64
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     target_arch: x86_64
2019-10-05T23:28:15.260+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27012 <span class="token punctuation">}</span>, replication: <span class="token punctuation">{</span> replSet: <span class="token string">"small-movie"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo2"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-05T23:28:15.273+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Detected data files <span class="token keyword">in</span> ./mongo2 created by the <span class="token string">'wiredTiger'</span> storage engine, so setting the active storage engine to <span class="token string">'wiredTiger'</span><span class="token keyword">.</span>
2019-10-05T23:28:15.276+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> wiredtiger_open config: create,cache_size<span class="token operator">=</span>257478M,cache_overflow<span class="token operator">=</span><span class="token punctuation">(</span>file_max<span class="token operator">=</span>0M<span class="token punctuation">)</span>,session_max<span class="token operator">=</span>20000,eviction<span class="token operator">=</span><span class="token punctuation">(</span>threads_min<span class="token operator">=</span>4,threads_max<span class="token operator">=</span>4<span class="token punctuation">)</span>,config_base<span class="token operator">=</span>false,statistics<span class="token operator">=</span><span class="token punctuation">(</span>fast<span class="token punctuation">)</span>,log<span class="token operator">=</span><span class="token punctuation">(</span>enabled<span class="token operator">=</span>true,archive<span class="token operator">=</span>true,path<span class="token operator">=</span>journal,compressor<span class="token operator">=</span>snappy<span class="token punctuation">)</span>,file_manager<span class="token operator">=</span><span class="token punctuation">(</span>close_idle_time<span class="token operator">=</span>100000<span class="token punctuation">)</span>,statistics_log<span class="token operator">=</span><span class="token punctuation">(</span>wait<span class="token operator">=</span>0<span class="token punctuation">)</span>,verbose<span class="token operator">=</span><span class="token punctuation">(</span>recovery_progress<span class="token punctuation">)</span>,
2019-10-05T23:28:19.684+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310899:684296<span class="token punctuation">]</span><span class="token punctuation">[</span>80429:0x7f1f255d5000<span class="token punctuation">]</span>, txn-recover: Main recovery loop: starting at 1/23168 to 2/256
2019-10-05T23:28:19.887+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310899:887768<span class="token punctuation">]</span><span class="token punctuation">[</span>80429:0x7f1f255d5000<span class="token punctuation">]</span>, txn-recover: Recovering log 1 through 2
2019-10-05T23:28:20.058+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310900:58766<span class="token punctuation">]</span><span class="token punctuation">[</span>80429:0x7f1f255d5000<span class="token punctuation">]</span>, txn-recover: Recovering log 2 through 2
2019-10-05T23:28:20.157+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570310900:157655<span class="token punctuation">]</span><span class="token punctuation">[</span>80429:0x7f1f255d5000<span class="token punctuation">]</span>, txn-recover: Set global recovery timestamp: 0
2019-10-05T23:28:21.407+0200 I RECOVERY <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger recoveryTimestamp. Ts: Timestamp<span class="token punctuation">(</span>0, 0<span class="token punctuation">)</span>
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-05T23:28:23.416+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:28:23.419+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:28:23.419+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-05T23:28:23.419+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-05T23:28:23.419+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-05T23:28:23.419+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:28:23.565+0200 I FTDC     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initializing full-time diagnostic data capture with directory <span class="token string">'./mongo2/diagnostic.data'</span>
2019-10-05T23:28:23.568+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local initialized voted <span class="token keyword">for</span> document at startup.
2019-10-05T23:28:23.685+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Rollback ID is 1
2019-10-05T23:28:23.685+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local replica <span class="token keyword">set</span> configuration document at startup<span class="token punctuation">;</span>  NoMatchingDocument: Did not <span class="token function">find</span> replica <span class="token keyword">set</span> configuration document <span class="token keyword">in</span> local.system.replset
2019-10-05T23:28:23.686+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions refresh interval: Replication has not yet been configured
2019-10-05T23:28:23.687+0200 I NETWORK  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27012
2019-10-05T23:28:23.687+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheReap<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions reap interval: config.system.sessions does not exist
</code></pre>
<h4 id="server-3">Server 3</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ mongod --replSet small-movie --dbpath ./mongo3 --port 27013
2019-10-05T23:30:31.680+0200 I STORAGE  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Max cache overflow <span class="token function">file</span> size custom option: 0
2019-10-05T23:30:31.683+0200 I CONTROL  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols <span class="token string">'none'</span>
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>81484 port<span class="token operator">=</span>27013 dbpath<span class="token operator">=</span>./mongo3 64-bit host<span class="token operator">=</span>lame10.enst.fr
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v4.0.12
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: 5776e3cbf9e7afe86e6b29e22520ffb6766e95d4
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> OpenSSL version: OpenSSL 1.0.0-fips 29 Mar 2010
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> modules: none
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build environment:
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distmod: amazon
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distarch: x86_64
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     target_arch: x86_64
2019-10-05T23:30:31.687+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27013 <span class="token punctuation">}</span>, replication: <span class="token punctuation">{</span> replSet: <span class="token string">"small-movie"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo3"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-05T23:30:31.693+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> wiredtiger_open config: create,cache_size<span class="token operator">=</span>257478M,cache_overflow<span class="token operator">=</span><span class="token punctuation">(</span>file_max<span class="token operator">=</span>0M<span class="token punctuation">)</span>,session_max<span class="token operator">=</span>20000,eviction<span class="token operator">=</span><span class="token punctuation">(</span>threads_min<span class="token operator">=</span>4,threads_max<span class="token operator">=</span>4<span class="token punctuation">)</span>,config_base<span class="token operator">=</span>false,statistics<span class="token operator">=</span><span class="token punctuation">(</span>fast<span class="token punctuation">)</span>,log<span class="token operator">=</span><span class="token punctuation">(</span>enabled<span class="token operator">=</span>true,archive<span class="token operator">=</span>true,path<span class="token operator">=</span>journal,compressor<span class="token operator">=</span>snappy<span class="token punctuation">)</span>,file_manager<span class="token operator">=</span><span class="token punctuation">(</span>close_idle_time<span class="token operator">=</span>100000<span class="token punctuation">)</span>,statistics_log<span class="token operator">=</span><span class="token punctuation">(</span>wait<span class="token operator">=</span>0<span class="token punctuation">)</span>,verbose<span class="token operator">=</span><span class="token punctuation">(</span>recovery_progress<span class="token punctuation">)</span>,
2019-10-05T23:30:34.183+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570311034:183644<span class="token punctuation">]</span><span class="token punctuation">[</span>81484:0x7fea58f13000<span class="token punctuation">]</span>, txn-recover: Set global recovery timestamp: 0
2019-10-05T23:30:34.292+0200 I RECOVERY <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger recoveryTimestamp. Ts: Timestamp<span class="token punctuation">(</span>0, 0<span class="token punctuation">)</span>
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-05T23:30:37.079+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:30:37.082+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:30:37.082+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-05T23:30:37.082+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-05T23:30:37.082+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-05T23:30:37.083+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:30:37.088+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.startup_log with generated UUID: 1475105d-dec1-4184-a814-e4dfd485e794
2019-10-05T23:30:37.302+0200 I FTDC     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initializing full-time diagnostic data capture with directory <span class="token string">'./mongo3/diagnostic.data'</span>
2019-10-05T23:30:37.304+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.oplogTruncateAfterPoint with generated UUID: 044e8993-4de1-4138-8d1a-a1567224ec46
2019-10-05T23:30:37.512+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.minvalid with generated UUID: 859f5b94-e923-483a-8e2e-e26c5b660a01
2019-10-05T23:30:37.722+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.replset.election with generated UUID: 17c6e322-b333-4bab-80ed-8e9c5678f408
2019-10-05T23:30:37.952+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local initialized voted <span class="token keyword">for</span> document at startup.
2019-10-05T23:30:37.952+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local Rollback ID document at startup. Creating one.
2019-10-05T23:30:37.952+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.system.rollback.id with generated UUID: 4c392043-132e-4296-8c03-3db186e34c0c
2019-10-05T23:30:38.162+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initialized the rollback ID to 1
2019-10-05T23:30:38.162+0200 I REPL     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Did not <span class="token function">find</span> local replica <span class="token keyword">set</span> configuration document at startup<span class="token punctuation">;</span>  NoMatchingDocument: Did not <span class="token function">find</span> replica <span class="token keyword">set</span> configuration document <span class="token keyword">in</span> local.system.replset
2019-10-05T23:30:38.163+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions refresh interval: Replication has not yet been configured
2019-10-05T23:30:38.163+0200 I NETWORK  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27013
2019-10-05T23:30:38.163+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheReap<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions reap interval: config.system.sessions does not exist
</code></pre>
<h3 id="connect-a-client-mongo-to-one-server.-through-the-client-initialize-the-replication-add-one-other-server-as-secondary-and-add-the-third-one-as-arbiter.">4. Connect a client (mongo) to one server. Through the client, initialize the replication: add one other server as secondary, and add the third one as arbiter.</h3>
<pre class=" language-bash"><code class="prism  language-bash">$ mongo localhost:27011
MongoDB shell version v4.0.12
connecting to: mongodb://localhost:27011/test?gssapiServiceName<span class="token operator">=</span>mongodb
Implicit session: session <span class="token punctuation">{</span> <span class="token string">"id"</span> <span class="token keyword">:</span> UUID<span class="token punctuation">(</span><span class="token string">"41e06f06-911b-4d07-9b5a-fecfc802e6fa"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
MongoDB server version: 4.0.12
Server has startup warnings:
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-05T23:18:37.058+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-05T23:18:37.061+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>

<span class="token operator">&gt;</span> rs.initiate<span class="token punctuation">(</span><span class="token punctuation">{</span>_id: <span class="token string">'small-movie'</span>,
<span class="token punctuation">..</span>. members: <span class="token punctuation">[</span> <span class="token punctuation">{</span>_id: 1, host: <span class="token string">'localhost:27011'</span><span class="token punctuation">}</span>,
<span class="token punctuation">..</span>. <span class="token punctuation">{</span>_id: 2, host: <span class="token string">'localhost:27012'</span><span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token string">"ok"</span> <span class="token keyword">:</span> 1,
        <span class="token string">"operationTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570312541, 1<span class="token punctuation">)</span>,
        <span class="token string">"<span class="token variable">$clusterTime</span>"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"clusterTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570312541, 1<span class="token punctuation">)</span>,
                <span class="token string">"signature"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"hash"</span> <span class="token keyword">:</span> BinData<span class="token punctuation">(</span>0,<span class="token string">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span><span class="token punctuation">)</span>,
                        <span class="token string">"keyId"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
small-movie:SECONDARY<span class="token operator">&gt;</span> rs.addArb<span class="token punctuation">(</span><span class="token string">"localhost:27013"</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token string">"ok"</span> <span class="token keyword">:</span> 1,
        <span class="token string">"operationTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570312554, 4<span class="token punctuation">)</span>,
        <span class="token string">"<span class="token variable">$clusterTime</span>"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"clusterTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570312554, 4<span class="token punctuation">)</span>,
                <span class="token string">"signature"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"hash"</span> <span class="token keyword">:</span> BinData<span class="token punctuation">(</span>0,<span class="token string">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span><span class="token punctuation">)</span>,
                        <span class="token string">"keyId"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
small-movie:PRIMARY<span class="token operator">&gt;</span>
</code></pre>
<h3 id="identify-the-master-from-the-outputs-of-the-servers-and-by-requesting-replica-set-information-from-the-servers.">5. Identify the master from the outputs of the servers’ and by requesting replica set information from the servers.</h3>
<h4 id="output-of-server-3">Output of server 3:</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-05T23:55:54.749+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> This node is localhost:27013 <span class="token keyword">in</span> the config
2019-10-05T23:55:54.749+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> transition to ARBITER from STARTUP
2019-10-05T23:55:54.750+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> Member localhost:27011 is now <span class="token keyword">in</span> state PRIMARY
2019-10-05T23:55:54.750+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> Member localhost:27012 is now <span class="token keyword">in</span> state SECONDARY
</code></pre>
<p>We can see that the <strong>server 1</strong> is the master, and we verify with requesting replica information from <em>localhost:27011</em>, alias <em>server 1</em>:</p>
<pre class=" language-bash"><code class="prism  language-bash">small-movie:PRIMARY<span class="token operator">&gt;</span> db.isMaster<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token string">"hosts"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"localhost:27011"</span>,
                <span class="token string">"localhost:27012"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"arbiters"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"localhost:27013"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"setName"</span> <span class="token keyword">:</span> <span class="token string">"small-movie"</span>,
        <span class="token string">"setVersion"</span> <span class="token keyword">:</span> 2,
        <span class="token string">"ismaster"</span> <span class="token keyword">:</span> true,
        <span class="token string">"secondary"</span> <span class="token keyword">:</span> false,
        <span class="token string">"primary"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27011"</span>,
        <span class="token string">"me"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27011"</span>,
        <span class="token string">"electionId"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"7fffffff0000000000000001"</span><span class="token punctuation">)</span>,
        <span class="token string">"lastWrite"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"opTime"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"ts"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570313094, 1<span class="token punctuation">)</span>,
                        <span class="token string">"t"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>1<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>,
                <span class="token string">"lastWriteDate"</span> <span class="token keyword">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2019-10-05T22:04:54Z"</span><span class="token punctuation">)</span>,
                <span class="token string">"majorityOpTime"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"ts"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570313094, 1<span class="token punctuation">)</span>,
                        <span class="token string">"t"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>1<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>,
                <span class="token string">"majorityWriteDate"</span> <span class="token keyword">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2019-10-05T22:04:54Z"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"maxBsonObjectSize"</span> <span class="token keyword">:</span> 16777216,
        <span class="token string">"maxMessageSizeBytes"</span> <span class="token keyword">:</span> 48000000,
        <span class="token string">"maxWriteBatchSize"</span> <span class="token keyword">:</span> 100000,
        <span class="token string">"localTime"</span> <span class="token keyword">:</span> ISODate<span class="token punctuation">(</span><span class="token string">"2019-10-05T22:04:56.015Z"</span><span class="token punctuation">)</span>,
        <span class="token string">"logicalSessionTimeoutMinutes"</span> <span class="token keyword">:</span> 30,
        <span class="token string">"minWireVersion"</span> <span class="token keyword">:</span> 0,
        <span class="token string">"maxWireVersion"</span> <span class="token keyword">:</span> 7,
        <span class="token string">"readOnly"</span> <span class="token keyword">:</span> false,
        <span class="token string">"ok"</span> <span class="token keyword">:</span> 1,
        <span class="token string">"operationTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570313094, 1<span class="token punctuation">)</span>,
        <span class="token string">"<span class="token variable">$clusterTime</span>"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"clusterTime"</span> <span class="token keyword">:</span> Timestamp<span class="token punctuation">(</span>1570313094, 1<span class="token punctuation">)</span>,
                <span class="token string">"signature"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"hash"</span> <span class="token keyword">:</span> BinData<span class="token punctuation">(</span>0,<span class="token string">"AAAAAAAAAAAAAAAAAAAAAAAAAAA="</span><span class="token punctuation">)</span>,
                        <span class="token string">"keyId"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can see from the output, the value <code>ismaster</code> is true.</p>
<h3 id="import-moviepeople-1000.jsonl-through-the-master.-observe-the-output-of-the-two-other-servers.">6. Import <code>moviepeople-1000.jsonl</code> through the master. Observe the output of the two other servers.</h3>
<p>Firstly we import the file to PRIMARY (master)</p>
<pre class=" language-bash"><code class="prism  language-bash">$ mongoimport --file lab_2_datasets/moviepeople-1000.jsonl --host<span class="token operator">=</span>localhost:27011 --collection small-movie
2019-10-06T00:21:39.754+0200    connected to: localhost:27011
2019-10-06T00:21:40.853+0200    imported 1000 documents
</code></pre>
<h4 id="server-1-primary">Server 1 Primary</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T00:21:39.753+0200 I NETWORK  <span class="token punctuation">[</span>listener<span class="token punctuation">]</span> connection accepted from 127.0.0.1:37940 <span class="token comment">#24 (9 connections now open)</span>
2019-10-06T00:21:39.954+0200 I STORAGE  <span class="token punctuation">[</span>conn24<span class="token punctuation">]</span> createCollection: test.small-movie with generated UUID: 14444f21-8c99-4ed8-a577-68c1ddf74abf
2019-10-06T00:21:40.851+0200 I COMMAND  <span class="token punctuation">[</span>conn24<span class="token punctuation">]</span> <span class="token function">command</span> test.small-movie command: insert <span class="token punctuation">{</span> insert: <span class="token string">"small-movie"</span>, writeConcern: <span class="token punctuation">{</span> getLastError: 1, w: <span class="token string">"majority"</span> <span class="token punctuation">}</span>, ordered: false, <span class="token variable">$db</span><span class="token keyword">:</span> <span class="token string">"test"</span> <span class="token punctuation">}</span> ninserted:1000 keysInserted:1000 numYields:0 reslen:245 locks:<span class="token punctuation">{</span> Global: <span class="token punctuation">{</span> acquireCount: <span class="token punctuation">{</span> r: 19, w: 19 <span class="token punctuation">}</span> <span class="token punctuation">}</span>, Database: <span class="token punctuation">{</span> acquireCount: <span class="token punctuation">{</span> w: 18, W: 1 <span class="token punctuation">}</span> <span class="token punctuation">}</span>, Collection: <span class="token punctuation">{</span> acquireCount: <span class="token punctuation">{</span> w: 18 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> storage:<span class="token punctuation">{</span><span class="token punctuation">}</span> protocol:op_query 898ms
</code></pre>
<h4 id="server-2-secondary">Server 2 SECONDARY</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T00:21:40.313+0200 I STORAGE  <span class="token punctuation">[</span>repl writer worker 0<span class="token punctuation">]</span> createCollection: test.small-movie with provided UUID: 14444f21-8c99-4ed8-a577-68c1ddf74abf
2019-10-06T00:21:40.492+0200 I REPL     <span class="token punctuation">[</span>repl writer worker 0<span class="token punctuation">]</span> applied op: <span class="token function">command</span> <span class="token punctuation">{</span> ts: Timestamp<span class="token punctuation">(</span>1570314099, 1<span class="token punctuation">)</span>, t: 1, h: 5483686551903084631, v: 2, op: <span class="token string">"c"</span>, ns: <span class="token string">"test.<span class="token variable">$cmd</span>"</span>, ui: UUID<span class="token punctuation">(</span><span class="token string">"14444f21-8c99-4ed8-a577-68c1ddf74abf"</span><span class="token punctuation">)</span>, wall: new Date<span class="token punctuation">(</span>1570314100303<span class="token punctuation">)</span>, o: <span class="token punctuation">{</span> create: <span class="token string">"small-movie"</span>, idIndex: <span class="token punctuation">{</span> v: 2, key: <span class="token punctuation">{</span> _id: 1 <span class="token punctuation">}</span>, name: <span class="token string">"_id_"</span>, ns: <span class="token string">"test.small-movie"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>, took 180ms
</code></pre>
<p>We can see that the SECONDARY copied the data set right after it has been created in the PRIMARY.</p>
<h4 id="server-3-arbiter">Server 3 ARBITER</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T00:20:05.568+0200 I NETWORK  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Successfully connected to localhost:27011 <span class="token punctuation">(</span>1 connections now <span class="token function">open</span> to localhost:27011 with a 0 second timeout<span class="token punctuation">)</span>
2019-10-06T00:20:05.568+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions refresh interval: config.system.sessions does not exist
2019-10-06T00:25:05.566+0200 I NETWORK  <span class="token punctuation">[</span>LogicalSessionCacheRefresh<span class="token punctuation">]</span> Starting new replica <span class="token keyword">set</span> monitor <span class="token keyword">for</span> small-movie/localhost:27011,localhost:27012
2019-10-06T00:25:05.566+0200 I CONTROL  <span class="token punctuation">[</span>LogicalSessionCacheReap<span class="token punctuation">]</span> Sessions collection is not <span class="token keyword">set</span> up<span class="token punctuation">;</span> waiting <span class="token keyword">until</span> next sessions reap interval: config.system.sessions does not exist
</code></pre>
<p>We can see that during this time, there is no single special output in <strong>ARBITER</strong>, which means the replication doesn’t take place here.</p>
<h3 id="once-the-synchronization-is-finished-stop-ctrl-c-the-master.-observe-the-output-of-the-two-other-servers.">7. Once the synchronization is finished, stop (ctrl-c) the master. Observe the output of the two other servers.</h3>
<p>Before we violently stop the <strong>master</strong>, I’ve checked the config by</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token operator">&gt;</span> rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token string">"_id"</span> <span class="token keyword">:</span> <span class="token string">"small-movie"</span>,
        <span class="token string">"version"</span> <span class="token keyword">:</span> 2,
        <span class="token string">"protocolVersion"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>1<span class="token punctuation">)</span>,
        <span class="token string">"writeConcernMajorityJournalDefault"</span> <span class="token keyword">:</span> true,
        <span class="token string">"members"</span> <span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                        <span class="token string">"_id"</span> <span class="token keyword">:</span> 1,
                        <span class="token string">"host"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27011"</span>,
                        <span class="token string">"arbiterOnly"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"buildIndexes"</span> <span class="token keyword">:</span> true,
                        <span class="token string">"hidden"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"priority"</span> <span class="token keyword">:</span> 1,
                        <span class="token string">"tags"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>

                        <span class="token punctuation">}</span>,
                        <span class="token string">"slaveDelay"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>,
                        <span class="token string">"votes"</span> <span class="token keyword">:</span> 1
                <span class="token punctuation">}</span>,
                <span class="token punctuation">{</span>
                        <span class="token string">"_id"</span> <span class="token keyword">:</span> 2,
                        <span class="token string">"host"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27012"</span>,
                        <span class="token string">"arbiterOnly"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"buildIndexes"</span> <span class="token keyword">:</span> true,
                        <span class="token string">"hidden"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"priority"</span> <span class="token keyword">:</span> 1,
                        <span class="token string">"tags"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>

                        <span class="token punctuation">}</span>,
                        <span class="token string">"slaveDelay"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>,
                        <span class="token string">"votes"</span> <span class="token keyword">:</span> 1
                <span class="token punctuation">}</span>,
                <span class="token punctuation">{</span>
                        <span class="token string">"_id"</span> <span class="token keyword">:</span> 3,
                        <span class="token string">"host"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27013"</span>,
                        <span class="token string">"arbiterOnly"</span> <span class="token keyword">:</span> true,
                        <span class="token string">"buildIndexes"</span> <span class="token keyword">:</span> true,
                        <span class="token string">"hidden"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"priority"</span> <span class="token keyword">:</span> 0,
                        <span class="token string">"tags"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>

                        <span class="token punctuation">}</span>,
                        <span class="token string">"slaveDelay"</span> <span class="token keyword">:</span> NumberLong<span class="token punctuation">(</span>0<span class="token punctuation">)</span>,
                        <span class="token string">"votes"</span> <span class="token keyword">:</span> 1
                <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"settings"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"chainingAllowed"</span> <span class="token keyword">:</span> true,
                <span class="token string">"heartbeatIntervalMillis"</span> <span class="token keyword">:</span> 2000,
                <span class="token string">"heartbeatTimeoutSecs"</span> <span class="token keyword">:</span> 10,
                <span class="token string">"electionTimeoutMillis"</span> <span class="token keyword">:</span> 10000,
                <span class="token string">"catchUpTimeoutMillis"</span> <span class="token keyword">:</span> -1,
                <span class="token string">"catchUpTakeoverDelayMillis"</span> <span class="token keyword">:</span> 30000,
                <span class="token string">"getLastErrorModes"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span>,
                <span class="token string">"getLastErrorDefaults"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"w"</span> <span class="token keyword">:</span> 1,
                        <span class="token string">"wtimeout"</span> <span class="token keyword">:</span> 0
                <span class="token punctuation">}</span>,
                <span class="token string">"replicaSetId"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d99115d77d9e6648402a3e4"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So from the <code>Settings</code> section, we can see <code>"heartbeatTimeoutSecs" : 10, "electionTimeoutMillis" : 10000</code>, so if we directly stop the <em>master</em>, the terminals will be flushed with at least 1000 error messages before the election, so before reset the  <code>"electionTimeoutMillis"</code>, I’ve tried with <code>rs.stepDown()</code> to call the election immediately.</p>
<pre class=" language-bash"><code class="prism  language-bash">small-movie:PRIMARY<span class="token operator">&gt;</span> rs.stepDown<span class="token punctuation">(</span><span class="token punctuation">)</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>js<span class="token punctuation">]</span> DBClientConnection failed to receive message from localhost:27011 - HostUnreachable: Connection closed by peer
2019-10-06T01:02:49.559+0200 E QUERY    <span class="token punctuation">[</span>js<span class="token punctuation">]</span> Error: error doing query: failed: network error <span class="token keyword">while</span> attempting to run <span class="token function">command</span> <span class="token string">'replSetStepDown'</span> on host <span class="token string">'localhost:27011'</span>  <span class="token keyword">:</span>
DB.prototype.runCommand@src/mongo/shell/db.js:168:1
DB.prototype.adminCommand@src/mongo/shell/db.js:186:16
rs.stepDown@src/mongo/shell/utils.js:1444:12
@<span class="token punctuation">(</span>shell<span class="token punctuation">)</span>:1:1
2019-10-06T01:02:49.561+0200 I NETWORK  <span class="token punctuation">[</span>js<span class="token punctuation">]</span> trying reconnect to localhost:27011 failed
2019-10-06T01:02:49.562+0200 I NETWORK  <span class="token punctuation">[</span>js<span class="token punctuation">]</span> reconnect localhost:27011 ok
small-movie:SECONDARY<span class="token operator">&gt;</span>
</code></pre>
<h4 id="from-server-1">from server 1</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T01:02:49.557+0200 I COMMAND  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Attempting to step down <span class="token keyword">in</span> response to replSetStepDown <span class="token function">command</span>
2019-10-06T01:02:49.557+0200 I REPL     <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> transition to SECONDARY from PRIMARY
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Skip closing connection <span class="token keyword">for</span> connection <span class="token comment"># 10</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Skip closing connection <span class="token keyword">for</span> connection <span class="token comment"># 9</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Skip closing connection <span class="token keyword">for</span> connection <span class="token comment"># 5</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Skip closing connection <span class="token keyword">for</span> connection <span class="token comment"># 2</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn12<span class="token punctuation">]</span> end connection 127.0.0.1:41476 <span class="token punctuation">(</span>7 connections now open<span class="token punctuation">)</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn14<span class="token punctuation">]</span> end connection 127.0.0.1:41482 <span class="token punctuation">(</span>6 connections now open<span class="token punctuation">)</span>
2019-10-06T01:02:49.558+0200 I NETWORK  <span class="token punctuation">[</span>conn13<span class="token punctuation">]</span> end connection 127.0.0.1:41480 <span class="token punctuation">(</span>5 connections now open<span class="token punctuation">)</span>
2019-10-06T01:02:49.558+0200 I REPL     <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Handing off election to localhost:27012
2019-10-06T01:02:49.559+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> Error sending response to client: SocketException: Broken pipe. Ending connection from 127.0.0.1:41460 <span class="token punctuation">(</span>connection id: 11<span class="token punctuation">)</span>
2019-10-06T01:02:49.559+0200 I NETWORK  <span class="token punctuation">[</span>conn11<span class="token punctuation">]</span> end connection 127.0.0.1:41460 <span class="token punctuation">(</span>4 connections now open<span class="token punctuation">)</span>
2019-10-06T01:02:49.561+0200 I NETWORK  <span class="token punctuation">[</span>listener<span class="token punctuation">]</span> connection accepted from 127.0.0.1:41618 <span class="token comment">#18 (5 connections now open)</span>
2019-10-06T01:02:49.562+0200 I NETWORK  <span class="token punctuation">[</span>conn18<span class="token punctuation">]</span> received client metadata from 127.0.0.1:41618 conn18: <span class="token punctuation">{</span> application: <span class="token punctuation">{</span> name: <span class="token string">"MongoDB Shell"</span> <span class="token punctuation">}</span>, driver: <span class="token punctuation">{</span> name: <span class="token string">"MongoDB Internal Client"</span>, version: <span class="token string">"4.0.12"</span> <span class="token punctuation">}</span>, os: <span class="token punctuation">{</span> type: <span class="token string">"Linux"</span>, name: <span class="token string">"Fedora release 30 (Thirty)"</span>, architecture: <span class="token string">"x86_64"</span>, version: <span class="token string">"Kernel 5.0.10-200.fc29.x86_64"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T01:02:50.529+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> Member localhost:27012 is now <span class="token keyword">in</span> state PRIMARY
2019-10-06T01:02:51.292+0200 I REPL     <span class="token punctuation">[</span>rsBackgroundSync<span class="token punctuation">]</span> <span class="token function">sync</span> <span class="token function">source</span> candidate: localhost:27012
2019-10-06T01:02:51.292+0200 I ASIO     <span class="token punctuation">[</span>RS<span class="token punctuation">]</span> Connecting to localhost:27012
2019-10-06T01:02:51.295+0200 I REPL     <span class="token punctuation">[</span>rsBackgroundSync<span class="token punctuation">]</span> Changed <span class="token function">sync</span> <span class="token function">source</span> from empty to localhost:27012
</code></pre>
<h4 id="from-server-2">from server 2</h4>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T01:02:49.559+0200 I COMMAND  <span class="token punctuation">[</span>conn3<span class="token punctuation">]</span> Received replSetStepUp request
2019-10-06T01:02:49.559+0200 I REPL     <span class="token punctuation">[</span>conn3<span class="token punctuation">]</span> Starting an election due to step up request
2019-10-06T01:02:49.559+0200 I REPL     <span class="token punctuation">[</span>conn3<span class="token punctuation">]</span> skipping dry run and running <span class="token keyword">for</span> election <span class="token keyword">in</span> term 6
2019-10-06T01:02:49.562+0200 I REPL     <span class="token punctuation">[</span>replexec-1<span class="token punctuation">]</span> VoteRequester<span class="token punctuation">(</span>term 6<span class="token punctuation">)</span> received a no vote from localhost:27013 with reason <span class="token string">"can see a healthy primary (localhost:27011) of equal or greater priority"</span><span class="token punctuation">;</span> response message: <span class="token punctuation">{</span> term: 6, voteGranted: false, reason: <span class="token string">"can see a healthy primary (localhost:27011) of equal or greater priority"</span>, ok: 1.0 <span class="token punctuation">}</span>
2019-10-06T01:02:49.564+0200 I REPL     <span class="token punctuation">[</span>replexec-12<span class="token punctuation">]</span> VoteRequester<span class="token punctuation">(</span>term 6<span class="token punctuation">)</span> received a <span class="token function">yes</span> vote from localhost:27011<span class="token punctuation">;</span> response message: <span class="token punctuation">{</span> term: 6, voteGranted: true, reason: <span class="token string">""</span>, ok: 1.0, operationTime: Timestamp<span class="token punctuation">(</span>1570316565, 1<span class="token punctuation">)</span>, <span class="token variable">$clusterTime</span><span class="token keyword">:</span> <span class="token punctuation">{</span> clusterTime: Timestamp<span class="token punctuation">(</span>1570316565, 1<span class="token punctuation">)</span>, signature: <span class="token punctuation">{</span> hash: BinData<span class="token punctuation">(</span>0, 0000000000000000000000000000000000000000<span class="token punctuation">)</span>, keyId: 0 <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T01:02:49.564+0200 I REPL     <span class="token punctuation">[</span>replexec-12<span class="token punctuation">]</span> election succeeded, assuming primary role <span class="token keyword">in</span> term 6
2019-10-06T01:02:49.564+0200 I REPL     <span class="token punctuation">[</span>replexec-12<span class="token punctuation">]</span> transition to PRIMARY from SECONDARY
2019-10-06T01:02:49.564+0200 I REPL     <span class="token punctuation">[</span>replexec-12<span class="token punctuation">]</span> Resetting <span class="token function">sync</span> <span class="token function">source</span> to empty, <span class="token function">which</span> was localhost:27011
2019-10-06T01:02:49.564+0200 I REPL     <span class="token punctuation">[</span>replexec-12<span class="token punctuation">]</span> Entering primary catch-up mode.
2019-10-06T01:02:49.565+0200 I REPL     <span class="token punctuation">[</span>replexec-16<span class="token punctuation">]</span> Member localhost:27011 is now <span class="token keyword">in</span> state SECONDARY
2019-10-06T01:02:49.565+0200 I REPL     <span class="token punctuation">[</span>replexec-16<span class="token punctuation">]</span> Caught up to the latest optime known via heartbeats after becoming primary. Target optime: <span class="token punctuation">{</span> ts: Timestamp<span class="token punctuation">(</span>1570316565, 1<span class="token punctuation">)</span>, t: 5 <span class="token punctuation">}</span>. My Last Applied: <span class="token punctuation">{</span> ts: Timestamp<span class="token punctuation">(</span>1570316565, 1<span class="token punctuation">)</span>, t: 5 <span class="token punctuation">}</span>
2019-10-06T01:02:49.565+0200 I REPL     <span class="token punctuation">[</span>replexec-16<span class="token punctuation">]</span> Exited primary catch-up mode.
2019-10-06T01:02:49.565+0200 I REPL     <span class="token punctuation">[</span>replexec-16<span class="token punctuation">]</span> Stopping replication producer
2019-10-06T01:02:49.566+0200 I REPL     <span class="token punctuation">[</span>rsBackgroundSync<span class="token punctuation">]</span> Replication producer stopped after oplog fetcher finished returning a batch from our <span class="token function">sync</span> source.  Abandoning this batch of oplog entries and re-evaluating our <span class="token function">sync</span> source.
2019-10-06T01:02:50.697+0200 I REPL     <span class="token punctuation">[</span>rsSync-0<span class="token punctuation">]</span> transition to primary complete<span class="token punctuation">;</span> database writes are now permitted
</code></pre>
<p>from server 3</p>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T01:02:50.479+0200 I REPL     <span class="token punctuation">[</span>replexec-0<span class="token punctuation">]</span> Member localhost:27012 is now <span class="token keyword">in</span> state PRIMARY
2019-10-06T01:02:50.479+0200 I REPL     <span class="token punctuation">[</span>replexec-1<span class="token punctuation">]</span> Member localhost:27011 is now <span class="token keyword">in</span> state SECONDARY
</code></pre>
<p>We can see that after server 1 steps down, server 2 is selected as PRIMARY after. So Now we try to shut down server 1 by <code>Ctrl+C</code>, so between numerous error messages as below on both servers:</p>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T13:07:15.192+0200 I ASIO     <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Failed to connect to localhost:27011 - HostUnreachable: Error connecting to localhost:27011 <span class="token punctuation">(</span>127.0.0.1:27011<span class="token punctuation">)</span> :: caused by :: Connection refused
2019-10-06T13:07:15.192+0200 I CONNPOOL <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Dropping all pooled connections to localhost:27011 due to HostUnreachable: Error connecting to localhost:27011 <span class="token punctuation">(</span>127.0.0.1:27011<span class="token punctuation">)</span> :: caused by :: Connection refused
2019-10-06T13:07:15.194+0200 I ASIO     <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Connecting to localhost:27011
2019-10-06T13:07:15.195+0200 I ASIO     <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Failed to connect to localhost:27011 - HostUnreachable: Error connecting to localhost:27011 <span class="token punctuation">(</span>127.0.0.1:27011<span class="token punctuation">)</span> :: caused by :: Connection refused
2019-10-06T13:07:15.195+0200 I CONNPOOL <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Dropping all pooled connections to localhost:27011 due to HostUnreachable: Error connecting to localhost:27011 <span class="token punctuation">(</span>127.0.0.1:27011<span class="token punctuation">)</span> :: caused by :: Connection refused
</code></pre>
<p>From <strong>SERVER 2</strong>, alias <strong>SECONDARY</strong> we can find</p>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T13:07:15.191+0200 I REPL     <span class="token punctuation">[</span>replexec-5<span class="token punctuation">]</span> Starting an election, since we've seen no PRIMARY <span class="token keyword">in</span> the past 10000ms
2019-10-06T13:07:15.191+0200 I REPL     <span class="token punctuation">[</span>replexec-5<span class="token punctuation">]</span> conducting a dry run election to see <span class="token keyword">if</span> we could be elected. current term: 2
2019-10-06T13:07:15.191+0200 I ASIO     <span class="token punctuation">[</span>Replication<span class="token punctuation">]</span> Connecting to localhost:27011
2019-10-06T13:07:15.192+0200 I REPL     <span class="token punctuation">[</span>replexec-4<span class="token punctuation">]</span> VoteRequester<span class="token punctuation">(</span>term 2 dry run<span class="token punctuation">)</span> received a <span class="token function">yes</span> vote from localhost:27013<span class="token punctuation">;</span> response message: <span class="token punctuation">{</span> term: 2, voteGranted: true, reason: <span class="token string">""</span>, ok: 1.0 <span class="token punctuation">}</span>
2019-10-06T13:07:15.192+0200 I REPL     <span class="token punctuation">[</span>replexec-4<span class="token punctuation">]</span> dry election run succeeded, running <span class="token keyword">for</span> election <span class="token keyword">in</span> term 3
2019-10-06T13:07:15.195+0200 I REPL     <span class="token punctuation">[</span>replexec-1<span class="token punctuation">]</span> VoteRequester<span class="token punctuation">(</span>term 3<span class="token punctuation">)</span> failed to receive response from localhost:27011: HostUnreachable: Error connecting to localhost:27011 <span class="token punctuation">(</span>127.0.0.1:27011<span class="token punctuation">)</span> :: caused by :: Connection refused
2019-10-06T13:07:15.206+0200 I REPL     <span class="token punctuation">[</span>replexec-6<span class="token punctuation">]</span> VoteRequester<span class="token punctuation">(</span>term 3<span class="token punctuation">)</span> received a <span class="token function">yes</span> vote from localhost:27013<span class="token punctuation">;</span> response message: <span class="token punctuation">{</span> term: 3, voteGranted: true, reason: <span class="token string">""</span>, ok: 1.0 <span class="token punctuation">}</span>
2019-10-06T13:07:15.206+0200 I REPL     <span class="token punctuation">[</span>replexec-6<span class="token punctuation">]</span> election succeeded, assuming primary role <span class="token keyword">in</span> term 3
2019-10-06T13:07:15.206+0200 I REPL     <span class="token punctuation">[</span>replexec-6<span class="token punctuation">]</span> transition to PRIMARY from SECONDARY
2019-10-06T13:07:15.206+0200 I REPL     <span class="token punctuation">[</span>replexec-6<span class="token punctuation">]</span> Resetting <span class="token function">sync</span> <span class="token function">source</span> to empty, <span class="token function">which</span> was :27017
2019-10-06T13:07:15.206+0200 I REPL     <span class="token punctuation">[</span>replexec-6<span class="token punctuation">]</span> Entering primary catch-up mode.
2019-10-06T13:07:15.210+0200 I REPL     <span class="token punctuation">[</span>replexec-7<span class="token punctuation">]</span> Caught up to the latest optime known via heartbeats after becoming primary. Target optime: <span class="token punctuation">{</span> ts: Timestamp<span class="token punctuation">(</span>1570360013, 1000<span class="token punctuation">)</span>, t: 1 <span class="token punctuation">}</span>. My Last Applied: <span class="token punctuation">{</span> ts: Timestamp<span class="token punctuation">(</span>1570360013, 1000<span class="token punctuation">)</span>, t: 1 <span class="token punctuation">}</span>
2019-10-06T13:07:15.210+0200 I REPL     <span class="token punctuation">[</span>replexec-7<span class="token punctuation">]</span> Exited primary catch-up mode.
2019-10-06T13:07:15.210+0200 I REPL     <span class="token punctuation">[</span>replexec-7<span class="token punctuation">]</span> Stopping replication producer
2019-10-06T13:07:16.400+0200 I REPL     <span class="token punctuation">[</span>rsSync-0<span class="token punctuation">]</span> transition to primary complete<span class="token punctuation">;</span> database writes are now permitted
</code></pre>
<p>and from <strong>SERVER 3</strong>, alias <strong>ARBITER</strong>:</p>
<pre class=" language-bash"><code class="prism  language-bash">2019-10-06T13:07:15.775+0200 I REPL     <span class="token punctuation">[</span>replexec-1<span class="token punctuation">]</span> Member localhost:27012 is now <span class="token keyword">in</span> state PRIMARY
</code></pre>
<p>I think now it’s better to use <code>rs.stepDown()</code> to test the election mechanism, for the <strong>error messages do not stop</strong> after the new PRIMARY has been elected.</p>
<h2 id="task-3-sharding">Task 3: sharding</h2>
<p>Task 3 is run under MongoDB version v2.6.12</p>
<h3 id="start-two-shard-servers.">1. Start two shard servers.</h3>
<pre class=" language-bash"><code class="prism  language-bash">$ <span class="token function">mkdir</span> ./mongo4 ./mongo5
</code></pre>
<h4 id="shard-server-1">shard server 1</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ mongod --shardsvr --dbpath ./mongo4 --port 27014 --smallfiles
2019-10-06T14:59:41.669+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>39532 port<span class="token operator">=</span>27014 dbpath<span class="token operator">=</span>./mongo4 64-bit host<span class="token operator">=</span>lame13.enst.fr
2019-10-06T14:59:41.669+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:59:41.669+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-06T14:59:41.669+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-06T14:59:41.669+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v2.6.12
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: d73c92b1c85703828b55c2916a5dd4ad46535f6a
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build info: Linux build5.ny.cbi.10gen.cc 2.6.32-431.3.1.el6.x86_64 <span class="token comment">#1 SMP Fri Jan 3 21:39:27 UTC 2014 x86_64 BOOST_LIB_VERSION=1_49</span>
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-06T14:59:41.670+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27014 <span class="token punctuation">}</span>, sharding: <span class="token punctuation">{</span> clusterRole: <span class="token string">"shardsvr"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo4"</span>, smallFiles: <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T14:59:41.772+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> journal dir<span class="token operator">=</span>./mongo4/journal
2019-10-06T14:59:41.772+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> recover <span class="token keyword">:</span> no journal files present, no recovery needed
2019-10-06T14:59:41.870+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocating new ns <span class="token function">file</span> ./mongo4/local.ns, filling with zeroes<span class="token punctuation">..</span>.
2019-10-06T14:59:42.119+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> allocating new datafile ./mongo4/local.0, filling with zeroes<span class="token punctuation">..</span>.
2019-10-06T14:59:42.120+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> creating directory ./mongo4/_tmp
2019-10-06T14:59:42.127+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> <span class="token keyword">done</span> allocating datafile ./mongo4/local.0, size: 16MB,  took 0.003 secs
2019-10-06T14:59:42.220+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build index on: local.startup_log properties: <span class="token punctuation">{</span> v: 1, key: <span class="token punctuation">{</span> _id: 1 <span class="token punctuation">}</span>, name: <span class="token string">"_id_"</span>, ns: <span class="token string">"local.startup_log"</span> <span class="token punctuation">}</span>
2019-10-06T14:59:42.220+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     added index to empty collection
2019-10-06T14:59:42.220+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">command</span> local.<span class="token variable">$cmd</span> command: create <span class="token punctuation">{</span> create: <span class="token string">"startup_log"</span>, size: 10485760, capped: <span class="token boolean">true</span> <span class="token punctuation">}</span> ntoreturn:1 keyUpdates:0 numYields:0  reslen:37 350ms
2019-10-06T14:59:42.221+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27014
</code></pre>
<h4 id="shard-server-2">shard server 2</h4>
<pre class=" language-bash"><code class="prism  language-bash">mongod --shardsvr --dbpath ./mongo5 --port 27015 --smallfiles
2019-10-06T15:00:05.458+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>39693 port<span class="token operator">=</span>27015 dbpath<span class="token operator">=</span>./mongo5 64-bit host<span class="token operator">=</span>lame13.enst.fr
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v2.6.12
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: d73c92b1c85703828b55c2916a5dd4ad46535f6a
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build info: Linux build5.ny.cbi.10gen.cc 2.6.32-431.3.1.el6.x86_64 <span class="token comment">#1 SMP Fri Jan 3 21:39:27 UTC 2014 x86_64 BOOST_LIB_VERSION=1_49</span>
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-06T15:00:05.459+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27015 <span class="token punctuation">}</span>, sharding: <span class="token punctuation">{</span> clusterRole: <span class="token string">"shardsvr"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongo5"</span>, smallFiles: <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T15:00:05.563+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> journal dir<span class="token operator">=</span>./mongo5/journal
2019-10-06T15:00:05.566+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> recover <span class="token keyword">:</span> no journal files present, no recovery needed
2019-10-06T15:00:05.662+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocating new ns <span class="token function">file</span> ./mongo5/local.ns, filling with zeroes<span class="token punctuation">..</span>.
2019-10-06T15:00:05.871+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> allocating new datafile ./mongo5/local.0, filling with zeroes<span class="token punctuation">..</span>.
2019-10-06T15:00:05.872+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> creating directory ./mongo5/_tmp
2019-10-06T15:00:05.877+0200 <span class="token punctuation">[</span>FileAllocator<span class="token punctuation">]</span> <span class="token keyword">done</span> allocating datafile ./mongo5/local.0, size: 16MB,  took 0.003 secs
2019-10-06T15:00:06.006+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build index on: local.startup_log properties: <span class="token punctuation">{</span> v: 1, key: <span class="token punctuation">{</span> _id: 1 <span class="token punctuation">}</span>, name: <span class="token string">"_id_"</span>, ns: <span class="token string">"local.startup_log"</span> <span class="token punctuation">}</span>
2019-10-06T15:00:06.006+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     added index to empty collection
2019-10-06T15:00:06.006+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">command</span> local.<span class="token variable">$cmd</span> command: create <span class="token punctuation">{</span> create: <span class="token string">"startup_log"</span>, size: 10485760, capped: <span class="token boolean">true</span> <span class="token punctuation">}</span> ntoreturn:1 keyUpdates:0 numYields:0  reslen:37 344ms
2019-10-06T15:00:06.007+0200 <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27015
</code></pre>
<h4 id="shard-config-server">shard config server</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ <span class="token function">mkdir</span> ./mongoconfig
$ mongod --configsvr --dbpath ./mongoconfig --port 27016
2019-10-06T14:46:32.984+0200 I STORAGE  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Max cache overflow <span class="token function">file</span> size custom option: 0
2019-10-06T14:46:32.987+0200 I CONTROL  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols <span class="token string">'none'</span>
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> MongoDB starting <span class="token keyword">:</span> pid<span class="token operator">=</span>45965 port<span class="token operator">=</span>27016 dbpath<span class="token operator">=</span>./mongoconfig 64-bit host<span class="token operator">=</span>lame10.enst.fr
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> db version v4.0.12
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> <span class="token function">git</span> version: 5776e3cbf9e7afe86e6b29e22520ffb6766e95d4
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> OpenSSL version: OpenSSL 1.0.0-fips 29 Mar 2010
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> modules: none
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> build environment:
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distmod: amazon
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     distarch: x86_64
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>     target_arch: x86_64
2019-10-06T14:46:32.991+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27016 <span class="token punctuation">}</span>, sharding: <span class="token punctuation">{</span> clusterRole: <span class="token string">"configsvr"</span> <span class="token punctuation">}</span>, storage: <span class="token punctuation">{</span> dbPath: <span class="token string">"./mongoconfig"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T14:46:32.998+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> wiredtiger_open config: create,cache_size<span class="token operator">=</span>257478M,cache_overflow<span class="token operator">=</span><span class="token punctuation">(</span>file_max<span class="token operator">=</span>0M<span class="token punctuation">)</span>,session_max<span class="token operator">=</span>20000,eviction<span class="token operator">=</span><span class="token punctuation">(</span>threads_min<span class="token operator">=</span>4,threads_max<span class="token operator">=</span>4<span class="token punctuation">)</span>,config_base<span class="token operator">=</span>false,statistics<span class="token operator">=</span><span class="token punctuation">(</span>fast<span class="token punctuation">)</span>,log<span class="token operator">=</span><span class="token punctuation">(</span>enabled<span class="token operator">=</span>true,archive<span class="token operator">=</span>true,path<span class="token operator">=</span>journal,compressor<span class="token operator">=</span>snappy<span class="token punctuation">)</span>,file_manager<span class="token operator">=</span><span class="token punctuation">(</span>close_idle_time<span class="token operator">=</span>100000<span class="token punctuation">)</span>,statistics_log<span class="token operator">=</span><span class="token punctuation">(</span>wait<span class="token operator">=</span>0<span class="token punctuation">)</span>,verbose<span class="token operator">=</span><span class="token punctuation">(</span>recovery_progress<span class="token punctuation">)</span>,
2019-10-06T14:46:35.098+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger message <span class="token punctuation">[</span>1570365995:98320<span class="token punctuation">]</span><span class="token punctuation">[</span>45965:0x7f8e9124c000<span class="token punctuation">]</span>, txn-recover: Set global recovery timestamp: 0
2019-10-06T14:46:35.209+0200 I RECOVERY <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> WiredTiger recoveryTimestamp. Ts: Timestamp<span class="token punctuation">(</span>0, 0<span class="token punctuation">)</span>
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: Access control is not enabled <span class="token keyword">for</span> the database.
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Read and <span class="token function">write</span> access to data and configuration is unrestricted.
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: This server is bound to localhost.
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Remote systems will be unable to connect to this server.
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          Start the server with --bind_ip <span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> to specify <span class="token function">which</span> IP
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          addresses it should serve responses from, or with --bind_ip_all to
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          bind to all interfaces. If this behavior is desired, start the
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          server with --bind_ip 127.0.0.1 to disable this warning.
2019-10-06T14:46:38.074+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:46:38.077+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:46:38.077+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> ** WARNING: You are running on a NUMA machine.
2019-10-06T14:46:38.077+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **          We suggest launching mongod like this to avoid performance problems:
2019-10-06T14:46:38.077+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> **              numactl --interleave<span class="token operator">=</span>all mongod <span class="token punctuation">[</span>other options<span class="token punctuation">]</span>
2019-10-06T14:46:38.077+0200 I CONTROL  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span>
2019-10-06T14:46:38.078+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: admin.system.version with provided UUID: abcfe4ac-16ca-4f3b-b9f9-5c492fb687fc
2019-10-06T14:46:38.298+0200 I COMMAND  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> setting featureCompatibilityVersion to 4.0
2019-10-06T14:46:38.305+0200 I STORAGE  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> createCollection: local.startup_log with generated UUID: 2fa6b2ca-90f0-49a7-a89b-720248257319
2019-10-06T14:46:38.518+0200 I FTDC     <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> Initializing full-time diagnostic data capture with directory <span class="token string">'./mongoconfig/diagnostic.data'</span>
2019-10-06T14:46:38.526+0200 I SHARDING <span class="token punctuation">[</span>thread1<span class="token punctuation">]</span> creating distributed lock <span class="token function">ping</span> thread <span class="token keyword">for</span> process ConfigServer <span class="token punctuation">(</span>sleeping <span class="token keyword">for</span> 30000ms<span class="token punctuation">)</span>
2019-10-06T14:46:38.528+0200 I STORAGE  <span class="token punctuation">[</span>replSetDistLockPinger<span class="token punctuation">]</span> createCollection: config.lockpings with generated UUID: 0da45068-131c-4f85-b77e-059a604db3fb
2019-10-06T14:46:38.529+0200 I SH_REFR  <span class="token punctuation">[</span>ConfigServerCatalogCacheLoader-0<span class="token punctuation">]</span> Refresh <span class="token keyword">for</span> database config took 0 ms and found <span class="token punctuation">{</span> _id: <span class="token string">"config"</span>, primary: <span class="token string">"config"</span>, partitioned: <span class="token boolean">true</span> <span class="token punctuation">}</span>
2019-10-06T14:46:38.529+0200 I NETWORK  <span class="token punctuation">[</span>initandlisten<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27016
</code></pre>
<h4 id="starting-mongos-connected-to-the-config">starting mongos connected to the config</h4>
<pre class=" language-bash"><code class="prism  language-bash"> mongos --configdb localhost:27016 --chunkSize 1 --port 27020
2019-10-06T15:00:39.480+0200 warning: running with 1 config server should be <span class="token keyword">done</span> only <span class="token keyword">for</span> testing purposes and is not recommended <span class="token keyword">for</span> production
2019-10-06T15:00:39.523+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> MongoS version 2.6.12 starting: pid<span class="token operator">=</span>39838 port<span class="token operator">=</span>27020 64-bit host<span class="token operator">=</span>lame13.enst.fr <span class="token punctuation">(</span>--help <span class="token keyword">for</span> usage<span class="token punctuation">)</span>
2019-10-06T15:00:39.523+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> db version v2.6.12
2019-10-06T15:00:39.523+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> <span class="token function">git</span> version: d73c92b1c85703828b55c2916a5dd4ad46535f6a
2019-10-06T15:00:39.523+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> build info: Linux build5.ny.cbi.10gen.cc 2.6.32-431.3.1.el6.x86_64 <span class="token comment">#1 SMP Fri Jan 3 21:39:27 UTC 2014 x86_64 BOOST_LIB_VERSION=1_49</span>
2019-10-06T15:00:39.523+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> allocator: tcmalloc
2019-10-06T15:00:39.524+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> options: <span class="token punctuation">{</span> net: <span class="token punctuation">{</span> port: 27020 <span class="token punctuation">}</span>, sharding: <span class="token punctuation">{</span> chunkSize: 1, configDB: <span class="token string">"localhost:27016"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T15:00:39.535+0200 <span class="token punctuation">[</span>LockPinger<span class="token punctuation">]</span> creating distributed lock <span class="token function">ping</span> thread <span class="token keyword">for</span> localhost:27016 and process lame13.enst.fr:27020:1570366839:1804289383 <span class="token punctuation">(</span>sleeping <span class="token keyword">for</span> 30000ms<span class="token punctuation">)</span>
2019-10-06T15:00:39.766+0200 <span class="token punctuation">[</span>LockPinger<span class="token punctuation">]</span> cluster localhost:27016 pinged successfully at Sun Oct  6 15:00:39 2019 by distributed lock pinger <span class="token string">'localhost:27016/lame13.enst.fr:27020:1570366839:1804289383'</span>, sleeping <span class="token keyword">for</span> 30000ms
2019-10-06T15:00:39.891+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> distributed lock <span class="token string">'configUpgrade/lame13.enst.fr:27020:1570366839:1804289383'</span> acquired, ts <span class="token keyword">:</span> 5d99e5778f4a75f6f53558fa
2019-10-06T15:00:39.892+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> starting upgrade of config server from v0 to v5
2019-10-06T15:00:39.893+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> starting next upgrade step from v0 to v5
2019-10-06T15:00:39.893+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> about to log new metadata event: <span class="token punctuation">{</span> _id: <span class="token string">"lame13.enst.fr-2019-10-06T13:00:39-5d99e5778f4a75f6f53558fb"</span>, server: <span class="token string">"lame13.enst.fr"</span>, clientAddr: <span class="token string">"N/A"</span>, time: new Date<span class="token punctuation">(</span>1570366839893<span class="token punctuation">)</span>, what: <span class="token string">"starting upgrade of config database"</span>, ns: <span class="token string">"config.version"</span>, details: <span class="token punctuation">{</span> from: 0, to: 5 <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T15:00:39.894+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> creating WriteBackListener for: localhost:27016 serverID: 000000000000000000000000
2019-10-06T15:00:39.906+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> writing initial config version at v5
2019-10-06T15:00:39.914+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> about to log new metadata event: <span class="token punctuation">{</span> _id: <span class="token string">"lame13.enst.fr-2019-10-06T13:00:39-5d99e5778f4a75f6f53558fd"</span>, server: <span class="token string">"lame13.enst.fr"</span>, clientAddr: <span class="token string">"N/A"</span>, time: new Date<span class="token punctuation">(</span>1570366839914<span class="token punctuation">)</span>, what: <span class="token string">"finished upgrade of config database"</span>, ns: <span class="token string">"config.version"</span>, details: <span class="token punctuation">{</span> from: 0, to: 5 <span class="token punctuation">}</span> <span class="token punctuation">}</span>
2019-10-06T15:00:39.921+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> upgrade of config server to v5 successful
2019-10-06T15:00:39.922+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> distributed lock <span class="token string">'configUpgrade/lame13.enst.fr:27020:1570366839:1804289383'</span> unlocked.
2019-10-06T15:00:39.973+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> scoped connection to localhost:27016 not being returned to the pool
2019-10-06T15:00:39.973+0200 <span class="token punctuation">[</span>Balancer<span class="token punctuation">]</span> about to contact config servers and shards
2019-10-06T15:00:39.974+0200 <span class="token punctuation">[</span>mongosMain<span class="token punctuation">]</span> waiting <span class="token keyword">for</span> connections on port 27020
2019-10-06T15:00:39.974+0200 <span class="token punctuation">[</span>Balancer<span class="token punctuation">]</span> config servers and shards contacted successfully
2019-10-06T15:00:39.974+0200 <span class="token punctuation">[</span>Balancer<span class="token punctuation">]</span> balancer id: lame13.enst.fr:27020 started at Oct  6 15:00:39
2019-10-06T15:00:39.978+0200 <span class="token punctuation">[</span>Balancer<span class="token punctuation">]</span> distributed lock <span class="token string">'balancer/lame13.enst.fr:27020:1570366839:1804289383'</span> acquired, ts <span class="token keyword">:</span> 5d99e5778f4a75f6f5355900
2019-10-06T15:00:39.979+0200 <span class="token punctuation">[</span>Balancer<span class="token punctuation">]</span> distributed lock <span class="token string">'balancer/lame13.enst.fr:27020:1570366839:1804289383'</span> unlocked.
</code></pre>
<h4 id="configure-sharding">Configure sharding</h4>
<pre class=" language-bash"><code class="prism  language-bash">$ mongo localhost:27020/admin
MongoDB shell version: 2.6.12
connecting to: localhost:27020/admin
mongos<span class="token operator">&gt;</span> db.runCommand<span class="token punctuation">(</span> <span class="token punctuation">{</span> addshard <span class="token keyword">:</span> <span class="token string">"localhost:27014"</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"shardAdded"</span> <span class="token keyword">:</span> <span class="token string">"shard0000"</span>, <span class="token string">"ok"</span> <span class="token keyword">:</span> 1 <span class="token punctuation">}</span>
mongos<span class="token operator">&gt;</span> db.runCommand<span class="token punctuation">(</span> <span class="token punctuation">{</span> addshard <span class="token keyword">:</span> <span class="token string">"localhost:27015"</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"shardAdded"</span> <span class="token keyword">:</span> <span class="token string">"shard0001"</span>, <span class="token string">"ok"</span> <span class="token keyword">:</span> 1 <span class="token punctuation">}</span>
mongos<span class="token operator">&gt;</span> db.runCommand<span class="token punctuation">(</span><span class="token punctuation">{</span> enablesharding: <span class="token string">"test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"ok"</span> <span class="token keyword">:</span> 1 <span class="token punctuation">}</span>
</code></pre>
<h3 id="shard-the-cities-by-the-country.">2. Shard the cities by the country.</h3>
<p>Import through the admin port:</p>
<pre class=" language-bash"><code class="prism  language-bash">mongoimport --db <span class="token function">test</span> --collection cities --file lab_2_datasets/cities.jsonl --port 27020 --drop

connected to: 127.0.0.1:27020
2019-10-06T15:25:30.672+0200 dropping: test.cities
2019-10-06T15:25:33.230+0200            Progress: 3786881/14333341      26%
2019-10-06T15:25:33.230+0200                    26400   8800/second
2019-10-06T15:25:37.672+0200            Progress: 6393010/14333341      44%
2019-10-06T15:25:37.672+0200                    44700   6385/second
2019-10-06T15:25:42.246+0200            Progress: 9071728/14333341      63%
2019-10-06T15:25:42.246+0200                    63500   5291/second
2019-10-06T15:25:46.680+0200            Progress: 11710098/14333341     81%
2019-10-06T15:25:46.680+0200                    82000   5125/second
2019-10-06T15:25:48.984+0200 check 9 99838
2019-10-06T15:25:55.047+0200 imported 99838 objects
</code></pre>
<p>Shard the collection imported by city:</p>
<pre class=" language-bash"><code class="prism  language-bash">mongos<span class="token operator">&gt;</span> use <span class="token function">test</span>
switched to db <span class="token function">test</span>
mongos<span class="token operator">&gt;</span> db.cities.ensureIndex<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"country"</span><span class="token keyword">:</span><span class="token string">"hashed"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token string">"raw"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"localhost:27014"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
                        <span class="token string">"createdCollectionAutomatically"</span> <span class="token keyword">:</span> false,
                        <span class="token string">"numIndexesBefore"</span> <span class="token keyword">:</span> 1,
                        <span class="token string">"numIndexesAfter"</span> <span class="token keyword">:</span> 2,
                        <span class="token string">"ok"</span> <span class="token keyword">:</span> 1
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"ok"</span> <span class="token keyword">:</span> 1
<span class="token punctuation">}</span>
mongos<span class="token operator">&gt;</span> use admin
switched to db admin
mongos<span class="token operator">&gt;</span> db.runCommand<span class="token punctuation">(</span> <span class="token punctuation">{</span> shardcollection <span class="token keyword">:</span> <span class="token string">"test.cities"</span>, key <span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token string">"country"</span> <span class="token keyword">:</span> <span class="token string">"hashed"</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">"collectionsharded"</span> <span class="token keyword">:</span> <span class="token string">"test.cities"</span>, <span class="token string">"ok"</span> <span class="token keyword">:</span> 1 <span class="token punctuation">}</span>
</code></pre>
<p>check the result</p>
<pre class=" language-bash"><code class="prism  language-bash">mongos<span class="token operator">&gt;</span> sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
--- Sharding Status ---
  sharding version: <span class="token punctuation">{</span>
        <span class="token string">"_id"</span> <span class="token keyword">:</span> 1,
        <span class="token string">"version"</span> <span class="token keyword">:</span> 4,
        <span class="token string">"minCompatibleVersion"</span> <span class="token keyword">:</span> 4,
        <span class="token string">"currentVersion"</span> <span class="token keyword">:</span> 5,
        <span class="token string">"clusterId"</span> <span class="token keyword">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">"5d99e5778f4a75f6f53558fc"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  shards:
        <span class="token punctuation">{</span>  <span class="token string">"_id"</span> <span class="token keyword">:</span> <span class="token string">"shard0000"</span>,  <span class="token string">"host"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27014"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span>  <span class="token string">"_id"</span> <span class="token keyword">:</span> <span class="token string">"shard0001"</span>,  <span class="token string">"host"</span> <span class="token keyword">:</span> <span class="token string">"localhost:27015"</span> <span class="token punctuation">}</span>
  databases:
        <span class="token punctuation">{</span>  <span class="token string">"_id"</span> <span class="token keyword">:</span> <span class="token string">"admin"</span>,  <span class="token string">"partitioned"</span> <span class="token keyword">:</span> false,  <span class="token string">"primary"</span> <span class="token keyword">:</span> <span class="token string">"config"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">{</span>  <span class="token string">"_id"</span> <span class="token keyword">:</span> <span class="token string">"test"</span>,  <span class="token string">"partitioned"</span> <span class="token keyword">:</span> true,  <span class="token string">"primary"</span> <span class="token keyword">:</span> <span class="token string">"shard0000"</span> <span class="token punctuation">}</span>
                test.cities
                        shard key: <span class="token punctuation">{</span> <span class="token string">"country"</span> <span class="token keyword">:</span> <span class="token string">"hashed"</span> <span class="token punctuation">}</span>
                        chunks:
                                shard0000       18
                                shard0001       17
                        too many chunks to print, use verbose <span class="token keyword">if</span> you want to force print
mongos<span class="token operator">&gt;</span> use <span class="token function">test</span>
switched to db <span class="token function">test</span>
mongos<span class="token operator">&gt;</span> db.cities.getShardDistribution<span class="token punctuation">(</span><span class="token punctuation">)</span>

Shard shard0000 at localhost:27014
 data <span class="token keyword">:</span> 22.85MiB docs <span class="token keyword">:</span> 99838 chunks <span class="token keyword">:</span> 18
 estimated data per chunk <span class="token keyword">:</span> 1.26MiB
 estimated docs per chunk <span class="token keyword">:</span> 5546

Shard shard0001 at localhost:27015
 data <span class="token keyword">:</span> 8.6MiB docs <span class="token keyword">:</span> 37607 chunks <span class="token keyword">:</span> 17
 estimated data per chunk <span class="token keyword">:</span> 518KiB
 estimated docs per chunk <span class="token keyword">:</span> 2212

Totals
 data <span class="token keyword">:</span> 31.45MiB docs <span class="token keyword">:</span> 137445 chunks <span class="token keyword">:</span> 35
 Shard shard0000 contains 72.63% data, 72.63% docs <span class="token keyword">in</span> cluster, avg obj size on shard <span class="token keyword">:</span> 240B
 Shard shard0001 contains 27.36% data, 27.36% docs <span class="token keyword">in</span> cluster, avg obj size on shard <span class="token keyword">:</span> 240B

mongos<span class="token operator">&gt;</span>
</code></pre>
<p>From the result above, we can see that the <code>cities</code> collection is successfully sharded on two servers with <code>"country"</code> as the key.</p>
</div>
</body>

</html>
